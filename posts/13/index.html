
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>xiaobaoqiu Blog</title>
  <meta name="author" content="xiaobaoqiu">

  
  <meta name="description" content="简单熟悉Apache附带的压测工具ab，它非常容易使用，ab可以直接在Web服务器本地发起测试请求。 需要清楚的是，ab进行一切测试的本质都是基于HTTP，所以可以说它是对于Web服务器软件的黑盒性能测试，它获得的一切数据和计算结果，都可以通过HTTP来解释。 本文的ab版本信息： 1
2
3
4 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xiaobaoqiu.github.io/posts/13/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  

  <link href="/atom.xml" rel="alternate" title="xiaobaoqiu Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  

  
  <meta name="baidu-site-verification" content="5oIt2xaFFz" />
  <meta name="google-site-verification" content="U9Avd5Yqzpetvn_zxo1KaK2iqYNwSlLon27veprwBRY" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">xiaobaoqiu Blog</a></h1>
  
    <h2>Think More, Code Less</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="xiaobaoqiu@163.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="xiaobaoqiu.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有博文</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/15/abjian-dan-shi-yong/">AB简单使用</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-15T22:04:47+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>简单熟悉Apache附带的压测工具ab，它非常容易使用，ab可以直接在Web服务器本地发起测试请求。</p>

<p>需要清楚的是，ab进行一切测试的本质都是基于HTTP，所以可以说它是对于Web服务器软件的黑盒性能测试，它获得的一切数据和计算结果，都可以通过HTTP来解释。</p>

<p>本文的ab版本信息：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress/source/images/io$ ab -V
</span><span class='line'>This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;
</span><span class='line'>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span><span class='line'>Licensed to The Apache Software Foundation, http://www.apache.org/</span></code></pre></td></tr></table></div></figure>


<h1>1.参数</h1>

<p>所有的参数及意义如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: ab [options] [http[s]://]hostname[:port]/path
</span><span class='line'>Options are:
</span><span class='line'>    -n requests     总请求数目，要访问页面的次数，默认为1
</span><span class='line'>    -c concurrency  同一时刻的并发请求数目，默认1
</span><span class='line'>    -t timelimit    测试进行的最大秒数，内部隐含值为50000，默认无时间限制
</span><span class='line'>    -s timeout      response超时时间，默认30秒
</span><span class='line'>    -b windowsize   TCP buffer的大小，单位是bytes
</span><span class='line'>    -B address      指定发出请求的本地ip地址
</span><span class='line'>    -p postfile     包含待POST的数据的文件，需要设置参数-T
</span><span class='line'>    -u putfile      包含待PUT的数据的文件，需要设置参数-T
</span><span class='line'>    -T content-type POST/PUT 数据的Content-type header信息, 比如.
</span><span class='line'>                    'application/x-www-form-urlencoded'
</span><span class='line'>                    默认是'text/plain'
</span><span class='line'>    -v verbosity    设置显示信息的详细程度，- 
</span><span class='line'>                    4或者更大的值会显示头信息，3或者更大的值可以显示响应代码(200等)，2或者更大可以显示警告和其他信息。
</span><span class='line'>    -w              已html表格的形式输出结果
</span><span class='line'>    -i              执行HEAD请求，而不是GET
</span><span class='line'>    -x attributes   设置&lt;table&gt;属性的字符串,此属性被填入&lt;table 这里&gt;
</span><span class='line'>    -y attributes   设置&lt;tr&gt;属性的字符串
</span><span class='line'>    -z attributes   设置&lt;td&gt;或者&lt;th&gt;属性的字符串
</span><span class='line'>    -C attribute    对请求附加一个Cookie行，其典型形式是name=value的一个参数对，  
</span><span class='line'>                    此参数可以重复。
</span><span class='line'>    -H attribute    对请求附加额外的头信息。此参数的典型形式是一个有效的头信息行，其中包含
</span><span class='line'>                    了以冒号分隔的字段和值的对 (如, "Accept-Encoding: zip/zop;8bit")
</span><span class='line'>    -A attribute    对服务器提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形
</span><span class='line'>                    式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。
</span><span class='line'>    -P attribute    对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64
</span><span class='line'>                    编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。
</span><span class='line'>    -X proxy:port   对请求使用代理服务器
</span><span class='line'>    -V              版本信息
</span><span class='line'>    -k              启用HTTP KeepAlive功能，即在一个HTTP会话中执行多个请求。 
</span><span class='line'>                    默认时，不启用KeepAlive功能Use HTTP KeepAlive feature
</span><span class='line'>    -d              不显示"percentage served within XX [ms] table"的消息.
</span><span class='line'>    -S              Do not show confidence estimators and warnings.
</span><span class='line'>    -q              如果处理的请求数大于150，  
</span><span class='line'>                    ab每处理大约10%或者100个请求时，会在stderr输出一个进度计数。 此-q标记可以抑制这些信息。
</span><span class='line'>    -g filename     Output collected data to gnuplot format file.
</span><span class='line'>    -e filename     产生一个以逗号分隔的(CSV)文件，其中包含了处理每个相应百分比的请求 
</span><span class='line'>                    所需要(从1%到100%)的相应百分比的(以微妙为单位)时间。由于这种格式已经“二进制化”，所以比'gnuplot'格式更有用。
</span><span class='line'>    -r              socket接收错误的时候也不退出
</span><span class='line'>    -h              显示usage信息</span></code></pre></td></tr></table></div></figure>


<h1>2.简单使用及结果解析</h1>

<p>就对我的博客进行压测，结果如下，简单加入了一些我的注释：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress/source/images/io$ ab -n 10 -c 2 -s 10 http://xiaobaoqiu.github.io/
</span><span class='line'>This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;
</span><span class='line'>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span><span class='line'>Licensed to The Apache Software Foundation, http://www.apache.org/
</span><span class='line'>
</span><span class='line'>Benchmarking xiaobaoqiu.github.io (be patient).....done
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Server Software:        GitHub.com
</span><span class='line'>Server Hostname:        xiaobaoqiu.github.io
</span><span class='line'>Server Port:            80
</span><span class='line'>
</span><span class='line'>Document Path:          /
</span><span class='line'>Document Length:        287269 bytes
</span><span class='line'>
</span><span class='line'>Concurrency Level:      2
</span><span class='line'>Time taken for tests:   20.788 seconds
</span><span class='line'>Complete requests:      10
</span><span class='line'>Failed requests:        0
</span><span class='line'>Write errors:           0
</span><span class='line'>Total transferred:      2877109 bytes
</span><span class='line'>HTML transferred:       2872690 bytes
</span><span class='line'>Requests per second:    0.48 [#/sec] (mean)
</span><span class='line'>Time per request:       4157.564 [ms] (mean)    #每个请求的时间
</span><span class='line'>Time per request:       2078.782 [ms] (mean, across all concurrent requests)
</span><span class='line'>Transfer rate:          135.16 [Kbytes/sec] received
</span><span class='line'>
</span><span class='line'>Connection Times (ms)
</span><span class='line'>              min  mean[+/-sd] median   max
</span><span class='line'>Connect:       59  402 717.5     94    2234
</span><span class='line'>Processing:   362 3674 3112.7   3479    8508
</span><span class='line'>Waiting:       60  164 132.8    100     407
</span><span class='line'>Total:        422 4076 3420.4   3558    8602
</span><span class='line'>
</span><span class='line'>Percentage of the requests served within a certain time (ms)
</span><span class='line'>  50%   3558        #50%的请求响应时间小于3558毫秒
</span><span class='line'>  66%   7110
</span><span class='line'>  75%   7312
</span><span class='line'>  80%   8544
</span><span class='line'>  90%   8602
</span><span class='line'>  95%   8602
</span><span class='line'>  98%   8602
</span><span class='line'>  99%   8602
</span><span class='line'> 100%   8602 (longest request)  #请求的最长响应时间为8602毫秒</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/08/ubuntuda-jian-ftp/">Ubuntu搭建FTP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-08T20:16:58+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:16 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>想在Ubuntu下搭建一个简单ftp服务器，用于和同事之间传数据。发现了vsftpd这个工具。</p>

<h1>1.vsftpd简介</h1>

<p>首先，网上介绍的比较全面的资料有：
vsftpd入门专题：<a href="http://os.51cto.com/art/201008/222036.htm">http://os.51cto.com/art/201008/222036.htm</a></p>

<p>我见过最好的vsftpd配置教程：<a href="http://blog.csdn.net/fafa211/article/details/8095081">http://blog.csdn.net/fafa211/article/details/8095081</a></p>

<p>前者确实介绍的很全面，但是有很多内容都是属于高级主题，初级用户真的很难全部看懂。如果使用要求不搞的话，其实后者就挺合适，更适合入门级菜鸟（想我这样的）参考，我就是参考这篇文章来搭建的。另外，还有一篇：<a href="http://www.blogjava.net/stonestyle/articles/369104.html%E3%80%82">http://www.blogjava.net/stonestyle/articles/369104.html%E3%80%82</a></p>

<h1>2.安装vsftpd</h1>

<p>直接运行下面命令即可:</p>

<pre><code>sudo apt-get install vsftpd
</code></pre>

<p>安装完毕后，默认配置下就可以直接登录fpt://ip了，比如我的IP是192.168.1.2，则直接在浏览器或者其他入口访问fpt://192.168.1.2。</p>

<p>默认情况下需要username和password访问，默认就是192.168.1.2的ubuntu系统中的账户。</p>

<p>参考文章有更详细的配置讲解。</p>

<h1>3.参考</h1>

<p><a href="http://blog.csdn.net/dongtingzhizi/article/details/12028627">http://blog.csdn.net/dongtingzhizi/article/details/12028627</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/io-mo-xing/">IO模型</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T19:38:04+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:38 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文主要想理清同步，异步，阻塞，非阻塞这几个概念;之后理解unix上的五种IO模型。</p>

<h1>1.同步VS异步，阻塞VS非阻塞</h1>

<h3>1.1 同步VS异步</h3>

<p>访问数据的方式，同步需要主动读写数据，在读写数据的过程中还是会阻塞；异步只需要I/O操作完成的通知，并不主动读写数据，由操作系统内核完成数据的读写。</p>

<p>同步(synchronous)和异步(asynchronous)是针对应用程序和内核的交互而言的:</p>

<pre><code>(1).同步指的是用户进程触发I/O操作并等待或者轮询的去查看I/O操作是否就绪;
(2).异步是指用户进程触发I/O操作以后便开始做自己的事情，而当I/O操作已经完成的时候会得到I/O完成的通知;
</code></pre>

<h3>1.2 阻塞VS非阻塞</h3>

<p>阻塞(blocking)和非阻塞(non-blocking)是针对于进程在访问数据的时候，根据I/O操作的就绪状态来采取的不同方式，说白了是一种读取或者写入操作函数的实现方式:</p>

<pre><code>(1).阻塞方式下读取或者写入函数将一直等待;
(2).非阻塞方式下，读取或者写入函数会立即返回一个状态值;
</code></pre>

<h1>2.IO模型</h1>

<p>《Unix网络编程卷》将unix上的IO模型分为5类：</p>

<pre><code>(1).Blocking I/O
(2).Nonblocking I/O
(3).I/O Multiplexing (select and poll)
(4).Signal Driven I/O (SIGIO)
(5).Asynchronous I/O (the POSIX aio_functions).
</code></pre>

<p>一个读操作通常包括两个不同阶段：</p>

<pre><code>(1).等待数据准备好;
(2).从内核向进程复制数据;
</code></pre>

<p>我们以一个从网络读数据为例，当网络数据包到达的时候，首先内核通过网卡读输入数据，数据被复制到内核的缓冲区;然后应用程序从内核中将数据拷贝到应用程序缓冲区。</p>

<p>以从网络读数据为例解释上面提到的5个IO模型, 即应用程序通过socket的recvfrom方法读取网络数据，关于recvfrom方法参考：<a href="http://baike.baidu.com/view/1744189.htm.">http://baike.baidu.com/view/1744189.htm.</a></p>

<h3>2.1 Blocking I/O</h3>

<p>阻塞IO：应用程序调用recvfrom试图读取数据，其实是通过系统调用从网卡读取网络数据，当网络无数据可读的时候，应用程序会一直等待;当内核从网卡读取完数据，会将数据从内核缓冲区拷贝到应用程序缓冲区，当拷贝完成，应用程序调用recvfrom才算完成。示意图如下：</p>

<p><img src="/images/io/block.jpg"></p>

<p>优势在于非常简单，等待的过程中占用的系统资源微乎其微，程序调用返回时，必定可以拿到数据；
但简单也带来一些缺点，程序在数据到来并准备好以前，不能进行其他操作;</p>

<h3>2.2 Nonblocking I/O</h3>

<p>非阻塞IO：应用程序调用recvfrom试图读取数据，当网络无数据可读的时候，应用程序不是一直等待，而是直接返回错误，过一段时间再去查看数据是否可读，即有一个操作时轮询（polling）。 示意图如下：</p>

<p><img src="/images/io/noblock.jpg"></p>

<p>这种模式在没有数据可以接收时，可以进行其他的一些操作；实际应用中，这种I/O模型的直接使用并不常见，因为它需要不停的查询，而这些查询大部分会是无必要的调用，白白浪费了系统资源；非阻塞I/O应该算是一个铺垫，为I/O复用和信号驱动奠定了非阻塞使用的基础。</p>

<h3>2.3 I/O Multiplexing</h3>

<p>首先I/O多路复用的函数也是阻塞的，但是其与以上两种还是有不同的，I/O多路复用是阻塞在select，epoll这样的系统调用之上，而没有阻塞在真正的I/O系统调用如recvfrom之上。</p>

<p>IO复用的目的：将等待数据准备和将数据拷贝给应用这两个阶段分开处理，让一个线程（而且是内核级别的线程）来处理所有的等待，一旦有相应的IO事件发生就通知继续完成IO操作，虽然仍然有阻塞和等待，但是等待总是发生在一个线程，这时使用多线程可以保证其他线程一旦唤醒就是处理数据。</p>

<p><img src="/images/io/select_poll.jpg"></p>

<p>至于select、poll和epoll的区别，推荐这篇文章： <a href="http://www.cnblogs.com/Anker/p/3265058.html">http://www.cnblogs.com/Anker/p/3265058.html</a> 。简单来说：select,poll无脑的轮询，忽略了高并发下，轮询本身成了瓶颈，而epoll使用回调实现了轮询真正需要处理的连接。</p>

<h3>2.4 Signal Driven I/O</h3>

<p>应用线程调用recvfrom试图读取数据，并且直接返回，不管是否有数据可读，内核线程读完数据，给发信号通知应用线程，应用线程收到信息，等待内核线程将数据拷贝给应用线程。</p>

<p><img src="/images/io/sign.jpg"></p>

<h3>2.5 Asynchronous I/O</h3>

<p>这类函数的工作机制是告知内核启动某个操作，并让内核在整个操作（包括将数据从内核拷贝到用户空间）完成后通知我们。</p>

<p><img src="/images/io/aio.jpg"></p>

<p>注意，之前的几个模型的recvfrom都是在数据拷贝完成（即第二阶段完成）才返回，而异步IO是在第一阶段直接返回并继续往下执行，数据拷贝完成后系统内核再通知应用进程。</p>

<h3>2.6 总结</h3>

<p>前4种都是同步IO，只有最后一种是异步IO。他们第二阶段（拷贝数据阶段）是相同的，区别在于第一阶段，同步IO第二阶段是阻塞的，即一定会阻塞于等待数据拷贝完成，而异步IO是不阻塞于数据拷贝，数据拷贝完成，内核进程会通知应用进程。</p>

<p>这就是同步和异步的区别：异步在整个过程都没有阻塞，而同步至少有一个步骤被阻塞（等待内核IO或者等待内核将数据拷贝给应用）。</p>

<p>5种IO的比较：</p>

<p><img src="/images/io/compare.png"></p>

<h1>3.举例子</h1>

<p>为了理解上面的理论，举例子如下：</p>

<p>陪女朋友逛街，逛累了，向找个地方吃饭，于是取了一个山西面馆，但是发现面馆生意比较好人比较多，而且面条都是先做的。但是这段时间又想干点别的事，比如去附近的书店看看书。于是引发了一些列的思考：</p>

<h3>3.1 Blocking I/O</h3>

<p>我不指定做面条需要多久，不敢出去，只能在那里坐在等。等做完，等服务员上面并且我吃调再走。</p>

<p>这里我们是应用线程，面条相当于等待读的数据，厨师相当于内核线程，我们需要等待初始做面条，还需要等待等服务员上面，我才能吃到我的面。</p>

<h3>3.2 Nonblocking I/O</h3>

<p>我不甘心在这里无聊的等待，我想在这段时间逛逛书店，但是又怕面条做好了，所有我决定取书店看一会书就回面馆看一下我的面是不是好了。如果没好继续取书店看会书再回面馆看看。结果就是来回跑了很多次。</p>

<h3>3.3 I/O Multiplexing</h3>

<p>我饭量比较大，同时在几个餐馆都点了饭菜，我这样来回来回看的话累死了，善良的管理员（管理所有餐馆）在前台装了一个大屏幕，上面写着每个人每个菜的状态。因此我虽然点了很多份饭菜，但只需要看屏幕就可以了。屏幕高速我某一个菜号了，我就可以去吃。</p>

<h3>3.4 Signal Driven I/O</h3>

<p>管理员看老是很多人来前台看状态，烦死了，于是弄来个喊号的系统，即每次有饭菜做好了，就会喊点菜的人来吃。但是，这个喊号的系统只会喊一次，并且如果同时多个菜好了，需要一个一个喊，因此部分饭菜有延时。</p>

<h3>3.5 Asynchronous I/O</h3>

<p>随着行业竞争加大，管理员为了提高用户体验，每次饭菜好了，让各个餐馆的服务员亲自将饭菜送到顾客的手上。</p>

<h1>4.参考</h1>

<p><a href="http://www.yeolar.com/note/2012/12/15/high-performance-io-design-patterns/">http://www.yeolar.com/note/2012/12/15/high-performance-io-design-patterns/</a></p>

<p><a href="http://www.cnblogs.com/zhuYears/archive/2012/09/28/2690194.html">http://www.cnblogs.com/zhuYears/archive/2012/09/28/2690194.html</a></p>

<p><a href="http://yaocoder.blog.51cto.com/2668309/1308899">http://yaocoder.blog.51cto.com/2668309/1308899</a></p>

<p><a href="http://www.open-open.com/doc/view/cbb2c3363c3b49ceb5812220a9c42e42">http://www.open-open.com/doc/view/cbb2c3363c3b49ceb5812220a9c42e42</a></p>

<p><a href="http://www.ibm.com/developerworks/cn/linux/l-async/">http://www.ibm.com/developerworks/cn/linux/l-async/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/31/githubbo-ke-jia-ping-lun/">Github博客加评论</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-31T01:43:36+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>1:43 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>想给自己的博客加评论很久了，一致没时间。今天抽了点时间，上午把google和百度检索的搞定了，下午抽时间把评论系统加上。</p>

<p>本文的评论是基于disqus实现的。</p>

<h1>1.Disqus介绍</h1>

<p>Disqus号称世界级的评论系统，对现在各种系统的支持都比较全面。</p>

<p>官方网站：<a href="https://disqus.com/">https://disqus.com/</a></p>

<h1>2.引用Disqus</h1>

<h3>2.1 注册</h3>

<p>在Disqus官网 <a href="https://disqus.com/">https://disqus.com/</a> 注册帐号</p>

<h3>2.2 Universal Code</h3>

<p><strong>(1).Add Disqus to your site，填写自己的网址，Disqus URL和Category等</strong></p>

<p><img src="/images/tools/disqus_add.png"></p>

<p><strong>(2).Choose your platform，生成Disqus Code</strong></p>

<p><img src="/images/tools/disqus_platform.png"></p>

<p>这里选择Universal Code，然后会生成一段代码：</p>

<p><img src="/images/tools/disqus_code.png"></p>

<p><strong>(3).引用Disqus Code</strong></p>

<p>将生成的代码嵌入到我们的博客系统中，以我的博客为例，找到source/_includes/post目录下的disqus_thread.html文件，将生成的代码放到这个文件中</p>

<p>在source/_layouts中模板页post.html中，引入disqus_thread.html文件：</p>

<p><img src="/images/tools/disqus_code_use.png"></p>

<p>其中的page.comments，在写每篇文章的时候进行设置，如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>layout: post
</span><span class='line'>title: "github博客加评论"
</span><span class='line'>date: 2014-12-30 17:43:36 +0000
</span><span class='line'>comments: true
</span><span class='line'>categories: Tools</span></code></pre></td></tr></table></div></figure>


<h3>3 效果</h3>

<p><img src="/images/tools/disqus_result.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/30/tomcat-access-logpei-zhi/">Tomcat Access Log配置</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-30T18:39:56+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:39 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在跟一个图片请求超时的问题，需要在项目的access log中增加请求的响应时间参数。正好学习一下tomcat access log中参数的配置。</p>

<p>我们假设将我的工程命名为project.com,即目录的文件名为project.com。</p>

<h1>1.配置的位置</h1>

<p>项目conf目录下的server.xml文件，其中的AccessLogValve这个Valve的配置，比如下面这个配置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" prefix="access." suffix=".log" 
</span><span class='line'>        pattern="%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %{X-Forwarded-For}i &quot;%Dms&quot;" resolveHosts="false"/&gt;</span></code></pre></td></tr></table></div></figure>


<h1>2.参数详解</h1>

<p>Tomcat AccessLogValve支持写列配置参数：</p>

<h3>2.1 className</h3>

<p>执行Access Log任务的类，默认是org.apache.catalina.valves.AccessLogValve;也可以使用org.apache.catalina.valves.FastCommonAccessLogValve，但这时候只支持common和combined patterns。</p>

<h3>2.2 directory</h3>

<p>AccessLogValve产生的Access Log文件存放目录的绝对路径或者相对路径。如果是相对路径，那么是相对$CATALINA_HOME的。如果没有指定这个参数，默认值是"logs"(相对$CATALINA_HOME)。</p>

<h3>2.3 pattern</h3>

<p>用于指定展示在Access Log中的各种request和response的信息字段的格式，也可以使用单词common或者combined来选择一种标准的日志形式。下一节会详细介绍。</p>

<p>注意优化的access只支持common和combined格式。</p>

<h3>2.4 prefix</h3>

<p>每个Access Log文件的文件名前缀，如果没有指定，默认是"access_log.&ldquo;，如果想没有前缀，则指定一个空的字符串(zero-length string)。</p>

<h3>2.5 resolveHosts</h3>

<p>如果设置为true，则会通过DNS lookup将远程主机的IP地址转换成对应的主机。设置成false则跳过这个DNS lookup过程，然后在日志中直接展示IP地址。</p>

<h3>2.6 suffix</h3>

<p>每个Access Log文件的文件名后缀，如果没有指定，默认值是“”，如果想没有后缀，则指定一个空的字符串(zero-length string)。</p>

<h3>2.7 rotatable</h3>

<p>默认为true。这个参数决定是否需要切换切换日志文件，如果被设置为false，则日志文件不会切换，即所有文件打到同一个日志文件中，并且fileDateFormat参数也会被忽略。小心使用这个参数。</p>

<h3>2.8 condition</h3>

<p>设置是否打开条件日志，如果设置了这个参数，requests只有当ServletRequest.getAttribute()为null的时候才会被记录日志。比如这个值被设置成junk，然后当一个特定请求的ServletRequest.getAttribute(&ldquo;junk&rdquo;) == null的时候，这个request会被记录。使用Filters很容易在ServletRequest中设置或者不设置这个属性。</p>

<h3>2.9 fileDateFormat</h3>

<p>Tomcat允许指定Access Log文件名中日期格式。日期格式同时也决定了如何切换日志文件的策略，比如如果你想每小时生成一个日志文件，设置这个值为yyyy-MM-dd.HH。</p>

<h1>3.pattern参数</h1>

<p>pattern属性有一系列的字符串参数组成，每个参数都有前缀"%&ldquo;，目前支持下面这些参数：</p>

<pre><code>%a - 远程IP地址
%A - 本地IP地址
%b - 发送的字节数(Bytes sent), 不包括HTTP headers的字节，如果为0则展示'-'
%B - 发送的字节数(Bytes sent), 不包括HTTP headers的字节
%h - 远程主机名称(如果resolveHosts为false则展示IP)
%H - 请求协议
%l - 远程用户名，始终为'-'(Remote logical username from identd)
%m - 请求的方法(GET, POST等)
%p - 接受请求的本地端口
%q - 查询字符串，如果存在，有一个前置的'?'
%r - 请求的第一行(包括请求方法和请求的URI)
%s - response的HTTP状态码(200,404等)
%S - 用户的session ID
%t - 日期和时间，Common Log Format格式
%u - 被认证的远程用户, 不存在则展示'-'
%U - 请求URL路径
%v - 本地服务名
%D - 处理请求的时间，单位为毫秒
%T - 处理请求的时间，单位为秒
%I - 当前请求的线程名(can compare later with stacktraces)
</code></pre>

<p>另外，Access Log中也支持cookie，请求header，响应headers，Session或者其他在ServletRequest中的对象的信息。格式遵循apache语法：</p>

<pre><code>%{xxx}i 请求headers的信息
%{xxx}o 响应headers的信息
%{xxx}c 请求cookie的信息
%{xxx}r xxx是ServletRequest的一个属性
%{xxx}s xxx是HttpSession的一个属性
</code></pre>

<p>common模式的pattern(即默认pattern参数)的格式为'%h %l %u %t &ldquo;%r&rdquo; %s %b'。</p>

<p>combined模式的pattern可以增加Referer和User-Agent headers的参数形式，每个参数用双引号包起来，引号中的内容还是上面列举的参数。比如&quot;%{User-Agent}i&quot;使其为”%{User-Agent}i“，即请求的User-Agent(客户端，浏览器)。</p>

<p>关于Common Log Format参考：<a href="http://baike.baidu.com/view/2948003.htm">http://baike.baidu.com/view/2948003.htm</a></p>

<h1>3.参考</h1>

<p><a href="http://tomcat.apache.org/tomcat-5.5-doc/config/valve.html">http://tomcat.apache.org/tomcat-5.5-doc/config/valve.html</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/14">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/12">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <div class="panel-heading">
    <h1 class="panel-title">最新文章</h3>
  </div>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/20/cratewen-dang-fan-yi/">Crate文档翻译</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/22/%5B%3F%5D-ge-si-suo-wen-ti/">一个死锁问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/15/cong-dai-li-dao-springshi-wu-aop/">从代理到Spring事务2-AOP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/07/springshi-wu/">从代理到Spring事务3-Spring事务</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/06/activitiru-men/">Activiti入门</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/11/cong-dai-li-dao-springshi-wu/">从代理到Spring事务1-代理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/03/strace/">Strace</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/28/who-eat-jvms-memory/">Who Eats JVM's Memory</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/22/protocol-buffers/">Protocol Buffers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/23/memcachedcun-chu-mei-ju/">Memcached存储枚举</a>
      </li>
    
  </ul>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">文章分类</h1>
  </div>
  <div id="categories_list_div" class="list-group">
    <li><a class='list-group-item' href='/blog/categories/algorithm/'>algorithm (5)</a></li>
<li><a class='list-group-item' href='/blog/categories/druid/'>druid (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/dubbo/'>dubbo (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/guava/'>guava (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/java/'>java (24)</a></li>
<li><a class='list-group-item' href='/blog/categories/library/'>library (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/linux/'>linux (13)</a></li>
<li><a class='list-group-item' href='/blog/categories/maven/'>maven (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/memcached/'>memcached (6)</a></li>
<li><a class='list-group-item' href='/blog/categories/mybatis/'>mybatis (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/mysql/'>mysql (12)</a></li>
<li><a class='list-group-item' href='/blog/categories/octopress/'>octopress (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/postgresql/'>postgresql (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/protocol/'>protocol (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/qa/'>qa (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/reading/'>reading (7)</a></li>
<li><a class='list-group-item' href='/blog/categories/search/'>search (9)</a></li>
<li><a class='list-group-item' href='/blog/categories/spring/'>spring (6)</a></li>
<li><a class='list-group-item' href='/blog/categories/squid/'>squid (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/structure/'>structure (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tomcat/'>tomcat (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tools/'>tools (8)</a></li>
<li><a class='list-group-item' href='/blog/categories/web/'>web (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/workflow/'>workflow (1)</a></li>
 
  </div>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">友情链接</h3>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://wenzhang.baidu.com/'>百度文章</a>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='https://github.com/xiaobaoqiu/leetcode'>LeetCode Solution</a>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://youdang.github.io/'>Youdang's Blog</a>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://blog.csdn.net/ghsau'>Gaoshuang's Blog</a>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://kriszhang.com/'>kriszhang's Blog</a>
  </div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - xiaobaoqiu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







<!--  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script> -->





</body>
</html>
