
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>xiaobaoqiu Blog</title>
  <meta name="author" content="xiaobaoqiu">

  
  <meta name="description" content="最近看到lscpu命令，简单实在。CPU的型号和L1，L2，L3 Cache大小等信息一目了然了。 类似的命令包括lsusb、lsblk命令。 1.lscpu 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
xiaobaoqiu@ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xiaobaoqiu.github.io/posts/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  

  <link href="/atom.xml" rel="alternate" title="xiaobaoqiu Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">xiaobaoqiu Blog</a></h1>
  
    <h2>Keep Runnnnnnnnnning...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="xiaobaoqiu@163.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="xiaobaoqiu.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有博文</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/25/lscpu/">Lscpu命令</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-25T18:52:34+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近看到lscpu命令，简单实在。CPU的型号和L1，L2，L3 Cache大小等信息一目了然了。</p>

<p>类似的命令包括lsusb、lsblk命令。</p>

<h1>1.lscpu</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ lscpu
</span><span class='line'>Architecture:          x86_64
</span><span class='line'>CPU op-mode(s):        32-bit, 64-bit
</span><span class='line'>Byte Order:            Little Endian
</span><span class='line'>CPU(s):                4                //逻辑cpu的个数
</span><span class='line'>On-line CPU(s) list:   0-3
</span><span class='line'>Thread(s) per core:    2
</span><span class='line'>Core(s) per socket:    2
</span><span class='line'>Socket(s):             1
</span><span class='line'>NUMA 节点：         1
</span><span class='line'>厂商 ID：           GenuineIntel
</span><span class='line'>CPU 系列：          6
</span><span class='line'>型号：              58
</span><span class='line'>步进：              9
</span><span class='line'>CPU MHz：             1200.000
</span><span class='line'>BogoMIPS:              5183.37
</span><span class='line'>虚拟化：           VT-x
</span><span class='line'>L1d 缓存：          32K
</span><span class='line'>L1i 缓存：          32K
</span><span class='line'>L2 缓存：           256K
</span><span class='line'>L3 缓存：           3072K
</span><span class='line'>NUMA node0 CPU(s):     0-3</span></code></pre></td></tr></table></div></figure>


<h1>2.lsusb</h1>

<p>lsusb命令显示usb设备的情况</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ lsusb
</span><span class='line'>Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
</span><span class='line'>Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span><span class='line'>Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
</span><span class='line'>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span><span class='line'>Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
</span><span class='line'>Bus 003 Device 003: ID 046d:c05a Logitech, Inc. M90/M100 Optical Mouse
</span><span class='line'>Bus 003 Device 002: ID 04b3:3025 IBM Corp. NetVista Full Width Keyboard
</span><span class='line'>Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span></code></pre></td></tr></table></div></figure>


<h1>3.lsblk</h1>

<p>lsblk命令显示块设备的情况</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ lsblk
</span><span class='line'>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
</span><span class='line'>sda      8:0    0 111.8G  0 disk 
</span><span class='line'>├─sda1   8:1    0   350M  0 part 
</span><span class='line'>└─sda2   8:2    0 111.5G  0 part 
</span><span class='line'>sdb      8:16   0 465.8G  0 disk 
</span><span class='line'>├─sdb1   8:17   0 299.8G  0 part 
</span><span class='line'>├─sdb2   8:18   0  15.1G  0 part [SWAP]
</span><span class='line'>└─sdb3   8:19   0 150.9G  0 part /</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/10/squidxue-xi/">Squid学习</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-10T21:14:57+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>之前在处理图片下载延时比较大问题的时候，OPS说使用Squid这个东东，抽时间看看这个东西。</p>

<p>简而言之，Squid就是一个Web缓存代理服务器。</p>

<h1>1.什么是代理服务器</h1>

<p>代理服务器是介于浏览器和Web服务器之间的另一台服务器。有了该服务器之后，浏览器发出的信息会先送到代理服务器，由代理服务器来取回网页内容并传送给客户的浏览器。对于企业网络而言，代理服务器可以起到控制网络访问并屏蔽不安全信息，以及网络加速的目的。</p>

<h1>2.Squid简介</h1>

<p>Squid官方网站 ： <a href="http://www.squid-cache.org/">http://www.squid-cache.org/</a></p>

<p>Squid 是一个 Web 缓存代理，支持 HTTP, HTTPS, FTP, 以及更多。它通过缓存与重用经常请求的web页面，减少带宽使用同时提升了响应时间，并设置过滤。使用Squid可以通过访问控制特性来灵活的控制用户访问时间、站点等限制。</p>

<h3>2.1 原理简介</h3>

<p>客户端请求访问 WEB 服务时，DNS 将访问的域名解析为 Squid 代理服务器的 IP 地址，这样客户端的 URL 请求将被发送到代理服务器。如果 Squid代理服务器中缓存了该请求的资源，则将该请求的资源直接返回给客户端，否则代理服务器将向后台的WEB服务器请求资源，然后将请求的应答返回给客户端，同时也将该应答缓存在本地，供下一个请求者使用。</p>

<h3>2.2 缓存限制</h3>

<p>Squid 代理一般只缓存可缓冲的数据（比如 html 网页和图片等），而一些ASP、JSP 之类的动态程序默认不缓存。它根据从 WEB 服务器返回的 HTTP 头标记来缓冲静态页面。有四个最重要 HTTP 头标记：</p>

<pre><code>Last-Modified: 告诉代理页面什么时间被修改
Expires: 告诉代理页面什么时间应该从缓冲区中删除
Cache-Control: 告诉代理页面是否应该被缓冲
Pragma: 用来包含实现特定的指令，最常用的是 Pragma:no-cache
</code></pre>

<h1>3.Squid安装</h1>

<pre><code>(1).下载 squid，这里下载的是3.4版本 : http://www.squid-cache.org/Versions/v3/3.4/
(2).解压缩
```
xiaobaoqiu@xiaobaoqiu:~/Download$ tar -xzvf squid-3.4.11.tar.gz
```
(3).配置
(待续...)
</code></pre>

<h1>4.参考</h1>

<p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-squid/">http://www.ibm.com/developerworks/cn/linux/l-cn-squid/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/09/ncming-ling/">Nc命令</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-09T19:36:17+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>nc(netcat)是网络工具中的瑞士军刀。</p>

<h1>1.参数</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~$ nc -h
</span><span class='line'>OpenBSD netcat (Debian patchlevel 1.105-7ubuntu1)
</span><span class='line'>This is nc from the netcat-openbsd package. An alternative nc is available
</span><span class='line'>in the netcat-traditional package.
</span><span class='line'>usage: nc [-46bCDdhjklnrStUuvZz] [-I length] [-i interval] [-O length]
</span><span class='line'>      [-P proxy_username] [-p source_port] [-q seconds] [-s source]
</span><span class='line'>      [-T toskeyword] [-V rtable] [-w timeout] [-X proxy_protocol]
</span><span class='line'>      [-x proxy_address[:port]] [destination] [port]
</span><span class='line'>    Command Summary:
</span><span class='line'>        -4          使用IPv4
</span><span class='line'>        -6          使用IPv6
</span><span class='line'>        -b          允许广播(broadcast)
</span><span class='line'>        -C          每行结尾加上CRLF(回车换行符)，即自动换行
</span><span class='line'>        -D          启动debug sock选项
</span><span class='line'>        -d          从stdin解绑(Detach from stdin)
</span><span class='line'>        -h          帮助文档
</span><span class='line'>        -I length   设置TCP接受的buffer长度
</span><span class='line'>        -i secs     设置消息发送及端口扫描时间间隔，单位秒
</span><span class='line'>        -j          Use jumbo frame
</span><span class='line'>        -k          当一个连接结束时，强制nc监听另一个连接。必须和-l一起使用
</span><span class='line'>        -l          监听模式，监听进入进入的连接(inbound connects)
</span><span class='line'>        -n          直接使用IP地址，而不通过域名服务器
</span><span class='line'>        -O length   设置TCP发送的buffer长度
</span><span class='line'>        -P proxyuser    代理权限使用的用户名
</span><span class='line'>        -p port     设置本地主机使用的通信端口
</span><span class='line'>        -q secs     quit after EOF on stdin and delay of secs
</span><span class='line'>        -r          随机指定本地主机使用的通信端口
</span><span class='line'>        -S          Enable the TCP MD5 signature option
</span><span class='line'>        -s addr     设置本地主机送出数据包的IP地址
</span><span class='line'>        -T toskeyword   指定链接的IP服务类型
</span><span class='line'>        -t          Answer TELNET negotiation
</span><span class='line'>        -U          Use UNIX domain socket
</span><span class='line'>        -u          使用UDP传输协议
</span><span class='line'>        -V rtable   指定可选的路由表
</span><span class='line'>        -v          显示指令执行过程
</span><span class='line'>        -w secs     设置连接的超时时间，单位秒
</span><span class='line'>        -X proto    指定代理协议: "4", "5" (SOCKS) or "connect"
</span><span class='line'>        -x addr[:port]  指定代理地址和端口号
</span><span class='line'>        -Z          DCCP mode
</span><span class='line'>        -z          0输入输出模式(只在端口扫描的时候使用)
</span><span class='line'>
</span><span class='line'>    注意：参数中端口号可以为单个端口，也可以是端口区间:low-high(闭区间)</span></code></pre></td></tr></table></div></figure>


<h1>2.典型使用case</h1>

<p>下面列举了几个典型的使用，更多使用case参见：
<a href="http://xmodulo.com/useful-netcat-examples-linux.html">http://xmodulo.com/useful-netcat-examples-linux.html</a></p>

<h3>2.1.文件传输</h3>

<p>在线上机器和本地机器之间传输文件，使用scp的话通常需要多次scp，并且通常需要密码，这是nc命令就显示其强大之处：</p>

<p>文件源端：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo cat abc.gz | nc -l 192.168.111.222 45678</span></code></pre></td></tr></table></div></figure>


<p>文件目的端：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nc 192.168.111.222 45678 &gt; abc.gz</span></code></pre></td></tr></table></div></figure>


<h3>2.2.端口扫描</h3>

<p>测试远端机器的某一个端口是否打开，succeeded表示打开：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~$ nc -v -w 2 192.168.111.222 -z 21-24
</span><span class='line'>Connection to 192.168.111.222 21 port [tcp/ftp] succeeded!
</span><span class='line'>Connection to 192.168.111.222 22 port [tcp/ssh] succeeded!
</span><span class='line'>nc: connect to 192.168.111.222 port 23 (tcp) failed: Connection refused
</span><span class='line'>nc: connect to 192.168.111.222 port 24 (tcp) failed: Connection refused</span></code></pre></td></tr></table></div></figure>


<h3>2.3.简单聊天工具</h3>

<p>一端打开：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~$ nc -l 1234
</span><span class='line'>hello
</span><span class='line'>yes</span></code></pre></td></tr></table></div></figure>


<p>另外一端连接，就可以聊天了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~$ nc 192.168.111.222 1234
</span><span class='line'>hello
</span><span class='line'>yes</span></code></pre></td></tr></table></div></figure>


<h1>3.参考</h1>

<p><a href="http://xmodulo.com/useful-netcat-examples-linux.html">http://xmodulo.com/useful-netcat-examples-linux.html</a></p>

<p><a href="http://mylinuxbook.com/linux-netcat-command/">http://mylinuxbook.com/linux-netcat-command/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/05/java-md5/">Java中MessageDigest计算MD5</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-05T21:40:13+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:40 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近项目的图片处理的系统出问题比较多，典型的一个问题就是因为计算md5出现的问题。</p>

<h1>1.问题</h1>

<p>问题的现象很简单，使用这套代码批量切图，会出现一张灵异图片，灵异之处在于，很多人批量切图都会出现这张图片，且这张图片不在他们的原始图片中。</p>

<h1>2.原因</h1>

<p>最后分析的原因是计算图片md5的代码，使用的是Java自带的MessageDigest，大致使用如下</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//声明
</span><span class='line'>private static MessageDigest md = null;
</span><span class='line'>
</span><span class='line'>//初始化
</span><span class='line'>static {
</span><span class='line'>    md = MessageDigest.getInstance("MD5");
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>//使用
</span><span class='line'>public static byte[] getMD5(byte[] bytes) {
</span><span class='line'>    md.update(bytes);   //-----------------------A
</span><span class='line'>    return md.digest(); //-----------------------B
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>问题的原因就是多线程计算md5的时候getMD5这个函数有问题。</p>

<h3>2.1 问题md5</h3>

<p>最后定位发现重复出现的md5是</p>

<pre><code>d41d8cd98f00b204e9800998ecf8427e
</code></pre>

<p>这是一个特殊的md5，即其是空字符串的md5：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MD5("") = d41d8cd98f00b204e9800998ecf8427e</span></code></pre></td></tr></table></div></figure>


<p>参考： <a href="http://zh.wikipedia.org/wiki/MD5">http://zh.wikipedia.org/wiki/MD5</a></p>

<h3>2.1 代码问题</h3>

<p>在MessageDigest类的源代码注释有这样一段话：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> * &lt;p&gt;A MessageDigest object starts out initialized. The data is
</span><span class='line'> * processed through it using the {@link #update(byte) update}
</span><span class='line'> * methods. At any point {@link #reset() reset} can be called
</span><span class='line'> * to reset the digest. Once all the data to be updated has been
</span><span class='line'> * updated, one of the {@link #digest() digest} methods should
</span><span class='line'> * be called to complete the hash computation.
</span><span class='line'> *
</span><span class='line'> * &lt;p&gt;The &lt;code&gt;digest&lt;/code&gt; method can be called once for a given number
</span><span class='line'> * of updates. After &lt;code&gt;digest&lt;/code&gt; has been called, the MessageDigest
</span><span class='line'> * object is reset to its initialized state.</span></code></pre></td></tr></table></div></figure>


<p>上面这段话第二部分的意思是说，digest()这个方法只能被调用一次，一旦调用MessageDigest对象会被重置到初始状态。</p>

<p>根据这个逻辑，getMD5这个函数的代码，多个线程进入这段代码的时候（这里假设两个线程），线程A执行完步骤1，在执行步骤2之前，线程B也执行完步骤1，之后线程B调用了步骤2得到正确的md5,之后线程A再调用步骤2的时候得到的md5就是d41d8cd98f00b204e9800998ecf8427e。</p>

<p>本地验证：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public static void main(String[] args) {
</span><span class='line'>    String src = "HelloWorld";
</span><span class='line'>
</span><span class='line'>    messageDigest.update(src.getBytes());
</span><span class='line'>
</span><span class='line'>    String md5 = bytesToHex(messageDigest.digest());
</span><span class='line'>    System.out.println("md5 = " + md5.toLowerCase());
</span><span class='line'>
</span><span class='line'>    String md5Again = bytesToHex(messageDigest.digest());
</span><span class='line'>    System.out.println("md5Again = " + md5Again.toLowerCase());
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>得到的结果：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>md5 = 68e109f0f40ca72a15e05cc22786f8e6
</span><span class='line'>md5Again = d41d8cd98f00b204e9800998ecf8427e</span></code></pre></td></tr></table></div></figure>


<h1>3.解决</h1>

<h3>3.1 MessageDigest正确用法</h3>

<p>MessageDigest类的注释里面其实给出了正确的用法，注意其md.clone()的调用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> MessageDigest md = MessageDigest.getInstance("MD5");
</span><span class='line'>
</span><span class='line'> try {
</span><span class='line'>     md.update(toChapter1);
</span><span class='line'>     MessageDigest tc1 = md.clone();
</span><span class='line'>     byte[] toChapter1Digest = tc1.digest();
</span><span class='line'>     md.update(toChapter2);
</span><span class='line'>     ...etc.
</span><span class='line'> } catch (CloneNotSupportedException cnse) {
</span><span class='line'>     throw new DigestException("couldn't make digest of partial content");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3.1 Apache的DigestUtils</h3>

<p>Apache的DigestUtils是一个线程安全的类，是对MessageDigest的封装，使用很简单，首先加入依赖：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;dependency&gt;
</span><span class='line'>    &lt;groupId&gt;commons-codec&lt;/groupId&gt;
</span><span class='line'>    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
</span><span class='line'>    &lt;version&gt;1.9&lt;/version&gt;
</span><span class='line'>&lt;/dependency&gt;</span></code></pre></td></tr></table></div></figure>


<p>然后就可以使用DigestUtils计算md5：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DigestUtils.md5(bytes)</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/31/netstatming-ling/">Netstat与ss命令</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-31T00:51:36+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>12:51 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ss是Socket Statistics的缩写。顾名思义，ss命令可以用来获取socket统计信息，它可以显示和netstat类似的内容。但ss的优势在于它能够显示更多更详细的有关TCP和连接状态的信息，而且比netstat更快速更高效。</p>

<p>当服务器的socket连接数量变得非常大时，无论是使用netstat命令还是直接cat /proc/net/tcp，执行速度都会很慢。这是很ss还是会很快。</p>

<p>ss 和 netstat 效率对比：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ time ss
</span><span class='line'>real    0m0.330s
</span><span class='line'>user    0m0.004s
</span><span class='line'>sys 0m0.013s
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ time netstat -at
</span><span class='line'>real    1m37.135s
</span><span class='line'>user    0m0.143s
</span><span class='line'>sys 0m0.020s</span></code></pre></td></tr></table></div></figure>


<h1>1.ss命令参数</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: ss [ OPTIONS ]
</span><span class='line'>       ss [ OPTIONS ] [ FILTER ]
</span><span class='line'>   -h, --help       帮助
</span><span class='line'>   -V, --version    版本信息
</span><span class='line'>   -n, --numeric    不解析服务名称
</span><span class='line'>   -r, --resolve    解析服务名称
</span><span class='line'>   -a, --all        显示所有套接字(sockets)
</span><span class='line'>   -l, --listening  显示listening状态的套接字(sockets)
</span><span class='line'>   -o, --options    显示计时器(timer)信息
</span><span class='line'>   -e, --extended   显示详细的套接字信息
</span><span class='line'>   -m, --memory     显示套接字的内存使用情况
</span><span class='line'>   -p, --processes  显示使用套接字的进程
</span><span class='line'>   -i, --info       显示TCP内部信息
</span><span class='line'>   -s, --summary    显示套接字使用概况
</span><span class='line'>   -b, --bpf        show bpf filter socket information
</span><span class='line'>   -4, --ipv4       仅显示IPv4的套接字
</span><span class='line'>   -6, --ipv6       仅显示IPv6的套接字
</span><span class='line'>   -0, --packet     显示 PACKET 套接字
</span><span class='line'>   -t, --tcp        仅显示TCP的套接字
</span><span class='line'>   -u, --udp        仅显示UDP的套接字
</span><span class='line'>   -d, --dccp       仅显示DCCP的套接字
</span><span class='line'>   -w, --raw        仅显示RAW的套接字
</span><span class='line'>   -x, --unix       仅显示Unix的套接字(domain sockets)
</span><span class='line'>   -f, --family=FAMILY 显示FAMILY类型的套接字(sockets)
</span><span class='line'>                    FAMILY可选,支持unix,inet,inet6,link,netlink
</span><span class='line'>
</span><span class='line'>   -A, --query=QUERY, --socket=QUERY
</span><span class='line'>       QUERY := {all|inet|tcp|udp|raw|unix|packet|netlink}[,QUERY]
</span><span class='line'>
</span><span class='line'>   -D, --diag=FILE     将原始TCP套接字(sockets)信息转储到文件
</span><span class='line'>   -F, --filter=FILE   从文件中读取过滤器信息
</span><span class='line'>       FILTER := [ state TCP-STATE ] [ EXPRESSION ]</span></code></pre></td></tr></table></div></figure>


<h1>2.简单使用</h1>

<h3>2.1 显示TCP连接</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss -ta
</span><span class='line'>State      Recv-Q Send-Q                 Local Address:Port                     Peer Address:Port   
</span><span class='line'>LISTEN     0      50                                 *:50955                               *:*       
</span><span class='line'>LISTEN     0      128                        127.0.0.1:11211                               *:*       
</span><span class='line'>LISTEN     0      50                                 *:63342                               *:*       
</span><span class='line'>LISTEN     0      50                                 *:2864                                *:*       
</span><span class='line'>LISTEN     0      5                          127.0.1.1:domain                              *:*    </span></code></pre></td></tr></table></div></figure>


<h3>2.2 显示 Sockets 摘要</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss -s
</span><span class='line'>Total: 871 (kernel 0)
</span><span class='line'>TCP:   44 (estab 8, closed 13, orphaned 0, synrecv 0, timewait 12/0), ports 0
</span><span class='line'>
</span><span class='line'>Transport Total     IP        IPv6
</span><span class='line'>*     0         -         -        
</span><span class='line'>RAW   0         0         0        
</span><span class='line'>UDP   21        16        5        
</span><span class='line'>TCP   31        23        8        
</span><span class='line'>INET      52        39        13       
</span><span class='line'>FRAG      0         0         0</span></code></pre></td></tr></table></div></figure>


<h3>2.3 列出所有打开的网络连接端口</h3>

<p>即处于Listening的端口</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss -l</span></code></pre></td></tr></table></div></figure>


<h3>2.4 查看进程使用的socket</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss -pl</span></code></pre></td></tr></table></div></figure>


<p>可以根据ss -pl结果进行grep</p>

<h3>2.5 匹配远程地址和端口号</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss dst 192.168.138.115
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ ss dst 192.168.138.115:17582</span></code></pre></td></tr></table></div></figure>


<h3>2.6 匹配本地地址和端口号</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/hotel/CRM/crm-main$ ss src 192.168.138.115</span></code></pre></td></tr></table></div></figure>


<h1>3.参考</h1>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/27/vmstatgong-ju/">Vmstat工具</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-27T06:16:56+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:16 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>vmstat命令是最常见的Linux/Unix监控工具，可以展现给定时间间隔的服务器的状态值,包括服务器的CPU使用率，内存使用，虚拟内存交换情况,IO读写情况。</p>

<h1>1.常用参数</h1>

<p>一般vmstat工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数，单位是秒，第二个参数是采样的次数</p>

<p>参数1表示每隔1秒打印一条信息</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/hotel/CRM/fs$ vmstat 1
</span><span class='line'>procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu----
</span><span class='line'> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa
</span><span class='line'> 2  0 299304 236692   8592 1589160    1    4   109   168  193   38 34 23 42  1
</span><span class='line'> 0  0 299304 236892   8592 1589028    0    0     4     0 8159 10012 17 15 69  0
</span><span class='line'> 0  0 299304 236324   8600 1589076    0    0     0   100 7979 8996  8 14 77  1
</span><span class='line'> 0  0 299304 236412   8600 1589124    0    0     0     0 8269 10878 17 14 69  0
</span><span class='line'> 2  0 299304 236656   8600 1589124    0    0     0     0 7900 9927 16 14 70  0
</span><span class='line'> 0  0 299304 236744   8600 1589084    0    0     0    36 8152 9840 15 16 69  0
</span><span class='line'> 0  0 299304 236480   8600 1589120    0    0     4     0 7903 10060 15 16 69  0</span></code></pre></td></tr></table></div></figure>


<h1>2.结果意义</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Procs
</span><span class='line'>r: 等待CPU的线程数目
</span><span class='line'>b: 等待IO而被Blocked的线程数目
</span><span class='line'>
</span><span class='line'>Memory
</span><span class='line'>swpd: 虚拟内存的使用(Swap空间的使用),如果大于0，表示你的机器物理内存不足了
</span><span class='line'>free: 空闲内存
</span><span class='line'>buff: 用作buffer的空间
</span><span class='line'>cache: 用作cache的空间
</span><span class='line'>
</span><span class='line'>Swap
</span><span class='line'>si: 每秒从磁盘读入虚拟内存的大小,如果这个值大于0,表示物理内存不够用或者内存泄露了,要查找耗内存进程解决掉
</span><span class='line'>so: 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上
</span><span class='line'>
</span><span class='line'>IO
</span><span class='line'>bi: 块设备每秒接收的块数量，这里的块设备是指系统上的磁盘等块设备
</span><span class='line'>bo: 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0
</span><span class='line'>
</span><span class='line'>System
</span><span class='line'>in: 每秒CPU的中断次数，包括时钟中断
</span><span class='line'>cs: 每秒上下文切换次数，这个值要越小越好，太大了，要考虑调低线程或者进程的数目
</span><span class='line'>
</span><span class='line'>CPU
</span><span class='line'>These are percentages of total CPU time.
</span><span class='line'>us: 用户CPU时间
</span><span class='line'>sy: 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁
</span><span class='line'>id: 空闲CPU时间
</span><span class='line'>wa: 等待IO的CPU时间</span></code></pre></td></tr></table></div></figure>


<h1>3.参考</h1>

<p><a href="http://www.thomas-krenn.com/en/wiki/Linux_Performance_Measurements_using_vmstat">http://www.thomas-krenn.com/en/wiki/Linux_Performance_Measurements_using_vmstat</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/23/jvmnei-cun-dumpcan-shu-pei-zhi/">JVM内存DUMP参数配置</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-23T23:04:31+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>11:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在JVM出现内存溢出或泄露时，为便于排查和定位，需要JVM的启动上增加相应的参数。主要是GC日志和内存DUMP参数.</p>

<h1>1.GC日志</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-Xloggc:$CATALINA_BASE/logs/gc.log</span></code></pre></td></tr></table></div></figure>


<h1>2.内存DUMP</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-XX:+HeapDumpOnOutOfMemoryError
</span><span class='line'>-XX:HeapDumpPath=$CATALINA_BASE/logs/heapDump.log</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/16/linuxwang-qia-su-du/">Linux网卡速度</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-16T18:58:54+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近项目的图片服务器从公司的服务器下载图片做裁剪等操作的时候，老是存在超时的问题</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java.net.SocketTimeoutException: Read timed out
</span><span class='line'>    at java.net.SocketInputStream.socketRead0(Native Method) ~[na:1.7.0_51]
</span><span class='line'>    at java.net.SocketInputStream.read(SocketInputStream.java:152) ~[na:1.7.0_51]
</span><span class='line'>    at java.net.SocketInputStream.read(SocketInputStream.java:122) ~[na:1.7.0_51]
</span><span class='line'>    at java.io.BufferedInputStream.read1(BufferedInputStream.java:273) ~[na:1.7.0_51]
</span><span class='line'>    at java.io.BufferedInputStream.read(BufferedInputStream.java:334) ~[na:1.7.0_51]
</span><span class='line'>    at sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[na:1.7.0_51]
</span><span class='line'>    at java.io.FilterInputStream.read(FilterInputStream.java:133) ~[na:1.7.0_51]</span></code></pre></td></tr></table></div></figure>


<p>手动wget图片一切正常，但是速度还不如本地机器，于是想看一下服务器的网卡信息。下面用本机作为示例：</p>

<h1>1.使用ifconfig找到网卡：</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>eth0      Link encap:以太网  硬件地址 f0:1f:af:27:58:8d  
</span><span class='line'>          inet 地址:192.168.138.99  广播:192.168.139.255  掩码:255.255.254.0
</span><span class='line'>          inet6 地址: fe80::f21f:afff:fe27:588d/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1
</span><span class='line'>          接收数据包:696848 错误:0 丢弃:0 过载:0 帧数:0
</span><span class='line'>          发送数据包:334077 错误:0 丢弃:0 过载:0 载波:0
</span><span class='line'>          碰撞:0 发送队列长度:1000 
</span><span class='line'>          接收字节:486532283 (486.5 MB)  发送字节:49164276 (49.1 MB)
</span><span class='line'>          中断:18 
</span><span class='line'>
</span><span class='line'>lo        Link encap:本地环回  
</span><span class='line'>          inet 地址:127.0.0.1  掩码:255.0.0.0
</span><span class='line'>          inet6 地址: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  跃点数:1
</span><span class='line'>          接收数据包:14772 错误:0 丢弃:0 过载:0 帧数:0
</span><span class='line'>          发送数据包:14772 错误:0 丢弃:0 过载:0 载波:0
</span><span class='line'>          碰撞:0 发送队列长度:0 
</span><span class='line'>          接收字节:1329005 (1.3 MB)  发送字节:1329005 (1.3 MB)</span></code></pre></td></tr></table></div></figure>


<h1>2.查看网卡是否被识别及型号</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ lspci | grep Ethernet
</span><span class='line'>0c:00.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5761 Gigabit Ethernet PCIe (rev 10)</span></code></pre></td></tr></table></div></figure>


<h1>3.使用ethtool工具查看网卡的详细信息：</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ sudo ethtool eth0
</span><span class='line'>[sudo] password for xiaobaoqiu: 
</span><span class='line'>Settings for eth0:
</span><span class='line'>    Supported ports: [ TP ]
</span><span class='line'>    Supported link modes:   10baseT/Half 10baseT/Full 
</span><span class='line'>                            100baseT/Half 100baseT/Full 
</span><span class='line'>                            1000baseT/Half 1000baseT/Full 
</span><span class='line'>    Supported pause frame use: No
</span><span class='line'>    Supports auto-negotiation: Yes
</span><span class='line'>    Advertised link modes:  10baseT/Half 10baseT/Full 
</span><span class='line'>                            100baseT/Half 100baseT/Full 
</span><span class='line'>                            1000baseT/Half 1000baseT/Full 
</span><span class='line'>    Advertised pause frame use: Symmetric
</span><span class='line'>    Advertised auto-negotiation: Yes
</span><span class='line'>    Link partner advertised link modes:  10baseT/Half 10baseT/Full 
</span><span class='line'>                                         100baseT/Half 100baseT/Full 
</span><span class='line'>    Link partner advertised pause frame use: No
</span><span class='line'>    Link partner advertised auto-negotiation: Yes
</span><span class='line'>    Speed: 100Mb/s      #网卡速度
</span><span class='line'>    Duplex: Full        #全双工
</span><span class='line'>    Port: Twisted Pair  #网络类型-双绞线
</span><span class='line'>    PHYAD: 1
</span><span class='line'>    Transceiver: internal
</span><span class='line'>    Auto-negotiation: on
</span><span class='line'>    MDI-X: on
</span><span class='line'>    Supports Wake-on: g
</span><span class='line'>    Wake-on: g          #唤醒起用（远程关机开机需设置）
</span><span class='line'>    Current message level: 0x000000ff (255)
</span><span class='line'>                   drv probe link timer ifdown ifup rx_err tx_err
</span><span class='line'>    Link detected: yes  #链路检测</span></code></pre></td></tr></table></div></figure>


<h1>4.查看网卡的连接状态</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ sudo mii-tool eth0
</span><span class='line'>eth0: negotiated 100baseTx-FD, link ok</span></code></pre></td></tr></table></div></figure>


<h1>5.网卡数据包收发统计</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress$ sudo ethtool -S eth0
</span><span class='line'>NIC statistics:
</span><span class='line'>     rx_octets: 494545915
</span><span class='line'>     rx_fragments: 0
</span><span class='line'>     rx_ucast_packets: 437748
</span><span class='line'>     rx_mcast_packets: 147474
</span><span class='line'>     rx_bcast_packets: 128799
</span><span class='line'>     rx_fcs_errors: 0
</span><span class='line'>     rx_align_errors: 0
</span><span class='line'>     rx_xon_pause_rcvd: 0
</span><span class='line'>     rx_xoff_pause_rcvd: 0
</span><span class='line'>     ...</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/16/how-to-read-files-quickly/">How to Read Files Quickly</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-16T01:00:42+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Java中有很多读写文件或者网络流的方法，特别是Java7中加入了AIO之后，可选择的方法更多，本文的目的是想比较一下各种方式的优劣。</p>

<p>本文基本是参考这篇英文：<a href="http://nadeausoftware.com/articles/2008/02/java_tip_how_read_files_quikcly">http://nadeausoftware.com/articles/2008/02/java_tip_how_read_files_quikcly</a></p>

<h1>1.方法List</h1>

<p>这里涉及的读文件的方法包括：</p>

<h3>1.1 FileInputStreamOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>public long doRead() throws IOException {
</span><span class='line'>    long checkSum = 0L;
</span><span class='line'>    FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>    int b;
</span><span class='line'>    while ((b = fis.read()) != -1)
</span><span class='line'>        checkSum += b;
</span><span class='line'>    Closeables.close(fis, false);
</span><span class='line'>    return checkSum;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>1.2 FileInputStreamBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>    public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        byte[] array = new byte[BUF_SIZE];
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = fis.read(array, 0, BUF_SIZE)) != -1) {
</span><span class='line'>            for (int i = 0; i &lt; nRead; i++)
</span><span class='line'>                checkSum += array[i];
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.3 BufferedInputStreamOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>    public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(filePath), BUF_SIZE);
</span><span class='line'>        int b;
</span><span class='line'>        while ((b = bis.read()) != -1)
</span><span class='line'>            checkSum += b;
</span><span class='line'>        Closeables.close(bis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.4 BufferedInputStreamBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>    public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(filePath), BUF_SIZE);
</span><span class='line'>        byte[] array = new byte[BUF_SIZE];
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = bis.read(array, 0, BUF_SIZE)) != -1) {
</span><span class='line'>            for (int i = 0; i &lt; nRead; i++)
</span><span class='line'>                checkSum += array[i];
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(bis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.5 RandomAccessOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        RandomAccessFile raf = new RandomAccessFile(filePath, READ_MODE);
</span><span class='line'>        int b;
</span><span class='line'>        while ((b = raf.read()) != -1) {
</span><span class='line'>            checkSum += b;
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(raf, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.6 RandomAccessBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        RandomAccessFile raf = new RandomAccessFile(filePath, READ_MODE);
</span><span class='line'>        byte[] array = new byte[BUF_SIZE];
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = raf.read(array, 0, BUF_SIZE)) != -1) {
</span><span class='line'>            for (int i = 0; i &lt; nRead; i++)
</span><span class='line'>                checkSum += array[i];
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(raf, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.7 FileChannelByteBufferOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        ByteBuffer bb = ByteBuffer.allocate(BUF_SIZE);
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = ch.read(bb)) != -1) {
</span><span class='line'>            if (nRead == 0)
</span><span class='line'>                continue;
</span><span class='line'>            bb.position(0);
</span><span class='line'>            bb.limit(nRead);
</span><span class='line'>            while (bb.hasRemaining())
</span><span class='line'>                checkSum += bb.get(); // 从ByteBuffer读一个字节
</span><span class='line'>            bb.clear();
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.8 FileChannelByteBufferBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        ByteBuffer bb = ByteBuffer.allocate(BIG_BUF_SIZE);
</span><span class='line'>        byte[] array = new byte[BUF_SIZE];
</span><span class='line'>        int nRead, nGet;
</span><span class='line'>        while ((nRead = ch.read(bb)) != -1) {
</span><span class='line'>            if (nRead == 0)
</span><span class='line'>                continue;
</span><span class='line'>            bb.position(0);
</span><span class='line'>            bb.limit(nRead);
</span><span class='line'>            while (bb.hasRemaining()) {
</span><span class='line'>                nGet = Math.min(bb.remaining(), BUF_SIZE);
</span><span class='line'>                bb.get(array, 0, nGet);
</span><span class='line'>                for (int i = 0; i &lt; nGet; i++)
</span><span class='line'>                    checkSum += array[i];
</span><span class='line'>            }
</span><span class='line'>            bb.clear();
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.9 FileChannelByteBufferWrap</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        byte[] barray = new byte[BUF_SIZE];
</span><span class='line'>        ByteBuffer bb = ByteBuffer.wrap(barray); // ByteBuffer包装本地array
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = ch.read(bb)) != -1) {
</span><span class='line'>            for (int i = 0; i &lt; nRead; i++)
</span><span class='line'>                checkSum += barray[i];
</span><span class='line'>            bb.clear();
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.10 FileChannelMappedByteBufferOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        MappedByteBuffer mb = ch.map(FileChannel.MapMode.READ_ONLY, 0L, ch.size());
</span><span class='line'>        while (mb.hasRemaining())
</span><span class='line'>            checkSum += mb.get();
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.11 FileChannelMappedByteBufferBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        MappedByteBuffer mb = ch.map(FileChannel.MapMode.READ_ONLY, 0L, ch.size());
</span><span class='line'>        byte[] barray = new byte[BUF_SIZE];
</span><span class='line'>        int nGet;
</span><span class='line'>        while (mb.hasRemaining()) {
</span><span class='line'>            nGet = Math.min(mb.remaining(), BUF_SIZE);
</span><span class='line'>            mb.get(barray, 0, nGet);
</span><span class='line'>            for (int i = 0; i &lt; nGet; i++)
</span><span class='line'>                checkSum += barray[i];
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.12 FileChannelDirectByteBufferOneByte</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        ByteBuffer bb = ByteBuffer.allocateDirect(BUF_SIZE);
</span><span class='line'>        int nRead;
</span><span class='line'>        while ((nRead = ch.read(bb)) != -1) {
</span><span class='line'>            bb.position(0);
</span><span class='line'>            bb.limit(nRead);
</span><span class='line'>            while (bb.hasRemaining())
</span><span class='line'>                checkSum += bb.get();
</span><span class='line'>            bb.clear();
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>1.13 FileChannelDirectByteBufferBytes</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public long doRead() throws IOException {
</span><span class='line'>        long checkSum = 0L;
</span><span class='line'>        FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>        FileChannel ch = fis.getChannel();
</span><span class='line'>        ByteBuffer bb = ByteBuffer.allocateDirect(BIG_BUF_SIZE);
</span><span class='line'>        byte[] barray = new byte[BUF_SIZE];
</span><span class='line'>        int nRead, nGet;
</span><span class='line'>        while ((nRead = ch.read(bb)) != -1) {
</span><span class='line'>            if (nRead == 0)
</span><span class='line'>                continue;
</span><span class='line'>            bb.position(0);
</span><span class='line'>            bb.limit(nRead);
</span><span class='line'>            while (bb.hasRemaining()) {
</span><span class='line'>                nGet = Math.min(bb.remaining(), BUF_SIZE);
</span><span class='line'>                bb.get(barray, 0, nGet);
</span><span class='line'>                for (int i = 0; i &lt; nGet; i++)
</span><span class='line'>                    checkSum += barray[i];
</span><span class='line'>            }
</span><span class='line'>            bb.clear();
</span><span class='line'>        }
</span><span class='line'>        Closeables.close(fis, false);
</span><span class='line'>        return checkSum;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h1>2.测试</h1>

<p>测试文件的大小为83M：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Documents/TestData$ ll -h BXBooks.sql
</span><span class='line'>-rw------- 1 xiaobaoqiu xiaobaoqiu 83M 10月  8  2004 BXBooks.sql</span></code></pre></td></tr></table></div></figure>


<h1>3.结论</h1>

<p>得到测试数据之后，为了直观展示代码的速度，用ECharts展示，对应的js代码如下(可以在<a href="http://echarts.baidu.com/doc/example/line1.html#helianthus%E4%B8%AD%E4%BD%BF%E7%94%A8">http://echarts.baidu.com/doc/example/line1.html#helianthus%E4%B8%AD%E4%BD%BF%E7%94%A8</a>)：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>option = {
</span><span class='line'>    title : {
</span><span class='line'>        text: 'how_to_read_file_quickly',
</span><span class='line'>        subtext: 'baoqiu.xiao'
</span><span class='line'>    },
</span><span class='line'>    tooltip : {
</span><span class='line'>        trigger: 'axis'
</span><span class='line'>    },
</span><span class='line'>    legend: {
</span><span class='line'>        data:['FileInputStreamOneByte','FileInputStreamBytes','BufferedInputStreamOneByte','BufferedInputStreamBytes','RandomAccessOneByte','RandomAccessBytes','FileChannelByteBufferOneByte','FileChannelByteBufferBytes','FileChannelByteBufferWrap','FileChannelMappedByteBufferOneByte','FileChannelMappedByteBufferBytes','FileChannelDirectByteBufferOneByte','FileChannelDirectByteBufferBytes']
</span><span class='line'>    },
</span><span class='line'>    dataZoom : {
</span><span class='line'>        show : true,
</span><span class='line'>        realtime: true,
</span><span class='line'>        start : 0,
</span><span class='line'>        end : 30
</span><span class='line'>    },
</span><span class='line'>    toolbox: {
</span><span class='line'>        show : true,
</span><span class='line'>        feature : {
</span><span class='line'>            saveAsImage : {show: true}
</span><span class='line'>        }
</span><span class='line'>    },
</span><span class='line'>    calculable : true,
</span><span class='line'>    xAxis : [
</span><span class='line'>        {
</span><span class='line'>            type : 'category',
</span><span class='line'>            boundaryGap : false,
</span><span class='line'>            data : ['1','2','4','8','16','32','64','128','256','512','1K','2K','4K','8K','16K','32K','64K','128K']
</span><span class='line'>        }
</span><span class='line'>    ],
</span><span class='line'>    yAxis : [
</span><span class='line'>        {
</span><span class='line'>            type : 'value',
</span><span class='line'>            axisLabel : {
</span><span class='line'>                formatter: '{value} 毫秒'
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    ],
</span><span class='line'>    series : [
</span><span class='line'>        {
</span><span class='line'>            name:'FileInputStreamOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[29119,28353,27872,27950,32035,40377,34904,36804,36835,33177,32252,37362,32359,31892,32621,32312,32943,33369]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileInputStreamBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[38182,20208,10194,4768,2616,1551,645,471,262,183,150,100,118,125,96,83,124,110]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'BufferedInputStreamOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[33404,16966,8613,4718,2525,1491,980,728,677,681,558,608,557,615,505,606,656,693]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'BufferedInputStreamBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[33880,17333,8487,4851,2293,1632,627,358,242,147,129,113,89,92,107,88,100,95]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'RandomAccessOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[28430,27445,26794,27053,28929,28633,29509,28870,28195,27376,28236,27444,28061,28889,27423,28064,28481,28084]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'RandomAccessBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[31497,16162,8135,4365,2131,1117,561,321,193,146,110,101,109,87,89,91,102,96]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelByteBufferOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[38778,18325,9447,5344,2430,1413,779,507,380,310,298,259,267,263,249,264,260,258]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelByteBufferBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[19279,9823,5090,2605,1407,854,577,380,333,272,272,239,237,241,237,234,249,270]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelByteBufferWrap',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[38382,17636,9094,4608,2327,1198,646,355,249,151,108,100,92,90,88,103,85,92]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelMappedByteBufferOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[913,240,92,83,82,87,85,88,83,94,87,90,81,124,81,84,83,120]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelMappedByteBufferBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[731,447,305,332,225,164,139,110,98,88,87,140,97,86,93,92,92,92]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelDirectByteBufferOneByte',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[31287,14473,7296,3815,1919,1001,547,319,200,135,109,98,84,77,80,82,77,86]
</span><span class='line'>        },
</span><span class='line'>        {
</span><span class='line'>            name:'FileChannelDirectByteBufferBytes',
</span><span class='line'>            type:'line',
</span><span class='line'>            data:[14945,8060,4107,2174,1120,580,334,206,149,110,96,95,79,89,81,81,86,84]
</span><span class='line'>        }       
</span><span class='line'>    ]
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>整体展示图如下：
<img src="/images/iospeed/read_file_speed.png"></p>

<h3>3.1 最快的三种方法</h3>

<p>为了展示更细节的地方，设置了y区间范围，在yAxis上设置min和max属性：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yAxis : [
</span><span class='line'>        {
</span><span class='line'>            type : 'value',
</span><span class='line'>            min:0,
</span><span class='line'>            max:200,
</span><span class='line'>            axisLabel : {
</span><span class='line'>                formatter: '{value} 毫秒'
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    ],</span></code></pre></td></tr></table></div></figure>


<p>得到如下展示图：
<img src="/images/iospeed/read_file_speed_small.png"></p>

<p>从上面这个图可以大致看出，最快的三种方法（PS，这里只做了一次实验，不是多次实验的平均值，所有数据可能不一定准确）：</p>

<pre><code>1.FileChannelMappedByteBufferBytes
2.FileChannelMappedByteBufferOneByte
3.FileChannelDirectByteBufferBytes
</code></pre>

<h1>4.解析</h1>

<p>下面解析一下代码中之前接触较少的东东。</p>

<h3>4.1 RandomAccessFile</h3>

<p>支持对文件的随机读取和写入。随机存取文件的行为类似存储在文件系统中的一个大型字节数组。存在指向该隐含数组的光标或索引，称为文件指针。</p>

<p>读取操作从文件指针开始读取字节，并随着对字节的读取而前移此文件指针。如果随机存取文件以读取/写入模式创建，则写入操作也可用；写入操作从文件指针开始写入字节，并随着对字节的写入而前移此文件指针。该文件指针可以通过 getFilePointer 方法读取，并通过 seek 方法设置。</p>

<p>提供了boolean，byte，char, short, int, long, float, double这些基本类型的read和write方法。</p>

<h3>4.2 FileChannel</h3>

<p>FileChannel是一个连接到文件的通道。可以通过文件通道读写文件。FileChannel无法设置为非阻塞模式，它总是运行在阻塞模式下。</p>

<p>在使用FileChannel之前，必须先打开它。但是，我们无法直接打开一个FileChannel，需要通过使用一个InputStream、OutputStream或RandomAccessFile来获取一个FileChannel实例。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FileInputStream fis = new FileInputStream(filePath);
</span><span class='line'>FileChannel ch = fis.getChannel();</span></code></pre></td></tr></table></div></figure>


<p>有时可能需要在FileChannel的某个特定位置进行数据的读/写操作。可以通过调用position()方法获取FileChannel的当前位置。也可以通过调用position(long pos)方法设置FileChannel的当前位置。</p>

<p>FileChannel实例的size()方法将返回该实例所关联文件的大小。</p>

<p>FileChannel.force()方法将通道里尚未写入磁盘的数据强制写到磁盘上。出于性能方面的考虑，操作系统会将数据缓存在内存中，所以无法保证写入到FileChannel里的数据一定会即时写到磁盘上。要保证这一点，需要调用force()方法。</p>

<h3>4.3 ByteBuffer</h3>

<p>ByteBuffer知识下一次单独讲。</p>

<h1>5.BufferedInputStream的defaultBufferSize</h1>

<p>BufferedInputStream默认buffer大小为8K：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class BufferedInputStream extends FilterInputStream {
</span><span class='line'>    private static int defaultBufferSize = 8192;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>这个从图上也可以比较直观的看到，在缓存为8K左右的时候，性能最好：
<img src="/images/iospeed/BufferedInputStream_buffer.png"></p>

<h1>5.参考：</h1>

<p><a href="http://nadeausoftware.com/articles/2008/02/java_tip_how_read_files_quickly">http://nadeausoftware.com/articles/2008/02/java_tip_how_read_files_quickly</a></p>

<p><a href="http://colobu.com/2014/10/20/java-buffer-basic/">http://colobu.com/2014/10/20/java-buffer-basic/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/15/abjian-dan-shi-yong/">AB简单使用</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-15T22:04:47+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>简单熟悉Apache附带的压测工具ab，它非常容易使用，ab可以直接在Web服务器本地发起测试请求。</p>

<p>需要清楚的是，ab进行一切测试的本质都是基于HTTP，所以可以说它是对于Web服务器软件的黑盒性能测试，它获得的一切数据和计算结果，都可以通过HTTP来解释。</p>

<p>本文的ab版本信息：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress/source/images/io$ ab -V
</span><span class='line'>This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;
</span><span class='line'>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span><span class='line'>Licensed to The Apache Software Foundation, http://www.apache.org/</span></code></pre></td></tr></table></div></figure>


<h1>1.参数</h1>

<p>所有的参数及意义如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: ab [options] [http[s]://]hostname[:port]/path
</span><span class='line'>Options are:
</span><span class='line'>    -n requests     总请求数目，要访问页面的次数，默认为1
</span><span class='line'>    -c concurrency  同一时刻的并发请求数目，默认1
</span><span class='line'>    -t timelimit    测试进行的最大秒数，内部隐含值为50000，默认无时间限制
</span><span class='line'>    -s timeout      response超时时间，默认30秒
</span><span class='line'>    -b windowsize   TCP buffer的大小，单位是bytes
</span><span class='line'>    -B address      指定发出请求的本地ip地址
</span><span class='line'>    -p postfile     包含待POST的数据的文件，需要设置参数-T
</span><span class='line'>    -u putfile      包含待PUT的数据的文件，需要设置参数-T
</span><span class='line'>    -T content-type POST/PUT 数据的Content-type header信息, 比如.
</span><span class='line'>                    'application/x-www-form-urlencoded'
</span><span class='line'>                    默认是'text/plain'
</span><span class='line'>    -v verbosity    设置显示信息的详细程度，- 
</span><span class='line'>                    4或者更大的值会显示头信息，3或者更大的值可以显示响应代码(200等)，2或者更大可以显示警告和其他信息。
</span><span class='line'>    -w              已html表格的形式输出结果
</span><span class='line'>    -i              执行HEAD请求，而不是GET
</span><span class='line'>    -x attributes   设置&lt;table&gt;属性的字符串,此属性被填入&lt;table 这里&gt;
</span><span class='line'>    -y attributes   设置&lt;tr&gt;属性的字符串
</span><span class='line'>    -z attributes   设置&lt;td&gt;或者&lt;th&gt;属性的字符串
</span><span class='line'>    -C attribute    对请求附加一个Cookie行，其典型形式是name=value的一个参数对，  
</span><span class='line'>                    此参数可以重复。
</span><span class='line'>    -H attribute    对请求附加额外的头信息。此参数的典型形式是一个有效的头信息行，其中包含
</span><span class='line'>                    了以冒号分隔的字段和值的对 (如, "Accept-Encoding: zip/zop;8bit")
</span><span class='line'>    -A attribute    对服务器提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形
</span><span class='line'>                    式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。
</span><span class='line'>    -P attribute    对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64
</span><span class='line'>                    编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。
</span><span class='line'>    -X proxy:port   对请求使用代理服务器
</span><span class='line'>    -V              版本信息
</span><span class='line'>    -k              启用HTTP KeepAlive功能，即在一个HTTP会话中执行多个请求。 
</span><span class='line'>                    默认时，不启用KeepAlive功能Use HTTP KeepAlive feature
</span><span class='line'>    -d              不显示"percentage served within XX [ms] table"的消息.
</span><span class='line'>    -S              Do not show confidence estimators and warnings.
</span><span class='line'>    -q              如果处理的请求数大于150，  
</span><span class='line'>                    ab每处理大约10%或者100个请求时，会在stderr输出一个进度计数。 此-q标记可以抑制这些信息。
</span><span class='line'>    -g filename     Output collected data to gnuplot format file.
</span><span class='line'>    -e filename     产生一个以逗号分隔的(CSV)文件，其中包含了处理每个相应百分比的请求 
</span><span class='line'>                    所需要(从1%到100%)的相应百分比的(以微妙为单位)时间。由于这种格式已经“二进制化”，所以比'gnuplot'格式更有用。
</span><span class='line'>    -r              socket接收错误的时候也不退出
</span><span class='line'>    -h              显示usage信息</span></code></pre></td></tr></table></div></figure>


<h1>2.简单使用及结果解析</h1>

<p>就对我的博客进行压测，结果如下，简单加入了一些我的注释：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/octopress/source/images/io$ ab -n 10 -c 2 -s 10 http://xiaobaoqiu.github.io/
</span><span class='line'>This is ApacheBench, Version 2.3 &lt;$Revision: 1430300 $&gt;
</span><span class='line'>Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span><span class='line'>Licensed to The Apache Software Foundation, http://www.apache.org/
</span><span class='line'>
</span><span class='line'>Benchmarking xiaobaoqiu.github.io (be patient).....done
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Server Software:        GitHub.com
</span><span class='line'>Server Hostname:        xiaobaoqiu.github.io
</span><span class='line'>Server Port:            80
</span><span class='line'>
</span><span class='line'>Document Path:          /
</span><span class='line'>Document Length:        287269 bytes
</span><span class='line'>
</span><span class='line'>Concurrency Level:      2
</span><span class='line'>Time taken for tests:   20.788 seconds
</span><span class='line'>Complete requests:      10
</span><span class='line'>Failed requests:        0
</span><span class='line'>Write errors:           0
</span><span class='line'>Total transferred:      2877109 bytes
</span><span class='line'>HTML transferred:       2872690 bytes
</span><span class='line'>Requests per second:    0.48 [#/sec] (mean)
</span><span class='line'>Time per request:       4157.564 [ms] (mean)    #每个请求的时间
</span><span class='line'>Time per request:       2078.782 [ms] (mean, across all concurrent requests)
</span><span class='line'>Transfer rate:          135.16 [Kbytes/sec] received
</span><span class='line'>
</span><span class='line'>Connection Times (ms)
</span><span class='line'>              min  mean[+/-sd] median   max
</span><span class='line'>Connect:       59  402 717.5     94    2234
</span><span class='line'>Processing:   362 3674 3112.7   3479    8508
</span><span class='line'>Waiting:       60  164 132.8    100     407
</span><span class='line'>Total:        422 4076 3420.4   3558    8602
</span><span class='line'>
</span><span class='line'>Percentage of the requests served within a certain time (ms)
</span><span class='line'>  50%   3558        #50%的请求响应时间小于3558毫秒
</span><span class='line'>  66%   7110
</span><span class='line'>  75%   7312
</span><span class='line'>  80%   8544
</span><span class='line'>  90%   8602
</span><span class='line'>  95%   8602
</span><span class='line'>  98%   8602
</span><span class='line'>  99%   8602
</span><span class='line'> 100%   8602 (longest request)  #请求的最长响应时间为8602毫秒</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/5">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/3">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <div class="panel-heading">
    <h1 class="panel-title">最新文章</h3>
  </div>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/08/03/fan-she-de-xiao-lu/">反射的效率</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/01/mycli/">Mycli</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/17/fen-ci/">分词</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/16/cratefu-wu-loadbiao-gao/">Crate服务load飙高</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/16/xi-tong-dang-qian-yong-hu/">系统当前用户</a>
      </li>
    
  </ul>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">文章分类</h1>
  </div>
  <div id="categories_list_div" class="list-group">
    <li><a class='list-group-item' href='/blog/categories/algorithm/'>algorithm (4)</a></li>
<li><a class='list-group-item' href='/blog/categories/dubbo/'>dubbo (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/guava/'>guava (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/java/'>java (22)</a></li>
<li><a class='list-group-item' href='/blog/categories/linux/'>linux (11)</a></li>
<li><a class='list-group-item' href='/blog/categories/maven/'>maven (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/memcached/'>memcached (4)</a></li>
<li><a class='list-group-item' href='/blog/categories/mysql/'>mysql (9)</a></li>
<li><a class='list-group-item' href='/blog/categories/octopress/'>octopress (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/postgresql/'>postgresql (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/qa/'>qa (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/reading/'>reading (7)</a></li>
<li><a class='list-group-item' href='/blog/categories/search/'>search (6)</a></li>
<li><a class='list-group-item' href='/blog/categories/spring/'>spring (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/squid/'>squid (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/structure/'>structure (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tomcat/'>tomcat (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tools/'>tools (8)</a></li>
<li><a class='list-group-item' href='/blog/categories/web/'>web (1)</a></li>
 
  </div>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">其他博客</h3>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://www.baidu.com/p/Nicker_2010'>百度空间</a>
  </div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - xiaobaoqiu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
