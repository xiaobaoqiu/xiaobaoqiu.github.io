
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GraphicsMagick - xiaobaoqiu Blog</title>
  <meta name="author" content="xiaobaoqiu">

  
  <meta name="description" content="1.介绍 GraphicsMagick 是个图片处理库，是从ImageMagick 5.5.2分支出来的，但是现在他变得更稳定和更轻、更快一些 GraphicsMagick号称图像处理领域的瑞士军刀。 短小精悍的代码却提供了一个鲁棒、高效的工具和库集合，来处理图像的读取、写入和操作， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xiaobaoqiu.github.io/blog/2014/09/09/graphicsmagick/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  

  <link href="/atom.xml" rel="alternate" title="xiaobaoqiu Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">xiaobaoqiu Blog</a></h1>
  
    <h2>Keep Runnnnnnnnnning...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="xiaobaoqiu@163.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="xiaobaoqiu.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有博文</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">GraphicsMagick</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-09T17:54:59+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:54 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h1>1.介绍</h1>

<p>GraphicsMagick 是个图片处理库，是从ImageMagick 5.5.2分支出来的，但是现在他变得更稳定和更轻、更快一些</p>

<p>GraphicsMagick号称图像处理领域的瑞士军刀。 短小精悍的代码却提供了一个鲁棒、高效的工具和库集合，来处理图像的读取、写入和操作，支持超过88种图像格式，包括重要的DPX、GIF、JPEG、JPEG-2000、PNG、PDF、PNM和TIFF。
通过使用OpenMP可是利用多线程进行图片处理，增强了通过扩展CPU提高处理能力。GraphicsMagick可以再绝大多数的平台上使用，Linux、Mac、Windows都没有问题。</p>

<p>GraphicsMagick支持大图片的处理，并且已经做过GB级别的图像处理实验。GraphicsMagick能够动态的生成图片，特别适用于互联网的应用。可以用来处理调整尺寸、旋转、加亮、颜色调整、增加特效等方面。GaphicsMagick不仅支持命令行的模式，同时也支持C、C++、Perl、PHP、Tcl、Ruby等的调用。</p>

<p>详细见GraphicsMagick官网： <a href="http://www.graphicsmagick.org/">http://www.graphicsmagick.org/</a></p>

<h1>2.Ubuntu安装</h1>

<p>应该是所有的Unix-like的安装都差不多。</p>

<h3>2.1 下载</h3>

<p>从<a href="http://www.graphicsmagick.org/index.html">官网</a>找到最新的release版本的下载地址，这里使用的版本是1.3.20(Released August 16, 2014)。</p>

<h3>2.2 安装</h3>

<p>下载到本机之后，依次解压，配置，make</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo tar -xvzf GraphicsMagick-1.3.20.tar.gz
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ cd GraphicsMagick-1.3.20/
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo ./configure
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo make
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo make install</span></code></pre></td></tr></table></div></figure>


<h3>2.3 验证</h3>

<p>验证安装是否成功，gm version</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ gm version
</span><span class='line'>GraphicsMagick 1.3.20 2014-08-16 Q8 http://www.GraphicsMagick.org/
</span><span class='line'>Copyright (C) 2002-2014 GraphicsMagick Group.
</span><span class='line'>Additional copyrights and licenses apply to this software.
</span><span class='line'>See http://www.GraphicsMagick.org/www/Copyright.html for details.
</span><span class='line'>
</span><span class='line'>Feature Support:
</span><span class='line'>  Native Thread Safe       yes
</span><span class='line'>  Large Files (&gt; 32 bit)   yes
</span><span class='line'>  Large Memory (&gt; 32 bit)  yes
</span><span class='line'>  BZIP                     no
</span><span class='line'>  DPS                      no
</span><span class='line'>  FlashPix                 no
</span><span class='line'>  FreeType                 yes
</span><span class='line'>  Ghostscript (Library)    no
</span><span class='line'>  JBIG                     no
</span><span class='line'>  JPEG-2000                no
</span><span class='line'>  JPEG                     no
</span><span class='line'>  Little CMS               no
</span><span class='line'>  Loadable Modules         no
</span><span class='line'>  OpenMP                   yes (201107)
</span><span class='line'>  PNG                      yes
</span><span class='line'>  TIFF                     no
</span><span class='line'>  TRIO                     no
</span><span class='line'>  UMEM                     no
</span><span class='line'>  WebP                     no
</span><span class='line'>  WMF                      no
</span><span class='line'>  X11                      yes
</span><span class='line'>  XML                      no
</span><span class='line'>  ZLIB                     yes
</span><span class='line'>
</span><span class='line'>Host type: x86_64-unknown-linux-gnu
</span><span class='line'>
</span><span class='line'>Configured using the command:
</span><span class='line'>  ./configure 
</span><span class='line'>
</span><span class='line'>Final Build Parameters:
</span><span class='line'>  CC       = gcc -std=gnu99
</span><span class='line'>  CFLAGS   = -fopenmp -g -O2 -Wall -pthread
</span><span class='line'>  CPPFLAGS = -I/usr/include/freetype2
</span><span class='line'>  CXX      = g++
</span><span class='line'>  CXXFLAGS = -pthread
</span><span class='line'>  LDFLAGS  = -L/usr/lib
</span><span class='line'>  LIBS     = -lfreetype -lpng12 -lXext -lSM -lICE -lX11 -lz -lm -lgomp -lpthread</span></code></pre></td></tr></table></div></figure>


<p>从上面也可以看到当前系统支持的图片格式。</p>

<h3>2.4 安装常见delegates</h3>

<p>GraphicsMagick支持很多格式，但是需要安装额外的delegates，常见的delegates见<a href="ftp://ftp.graphicsmagick.org/pub/GraphicsMagick/delegates/">这里</a>。</p>

<p>这里以jpeg为例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo wget ftp://ftp.graphicsmagick.org/pub/GraphicsMagick/delegates/jpegsrc.v9.tar.gz
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo tar xvfz jpegsrc.v9.tar.gz
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20/delegates/jpeg-9$ sudo ./configure --enable-shared
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20/delegates/jpeg-9$ sudo make
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20/delegates/jpeg-9$ sudo make install</span></code></pre></td></tr></table></div></figure>


<p>再次重新安装GraphicsMagick，在configure的时候会发现支持jpeg：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo ./configure
</span><span class='line'>...
</span><span class='line'>JPEG v1           --with-jpeg=yes           yes
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo make
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ sudo make install</span></code></pre></td></tr></table></div></figure>


<p>碰到的问题：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ gm version
</span><span class='line'>gm: error while loading shared libraries: libjpeg.so.9: cannot open shared object file: No such file or directory</span></code></pre></td></tr></table></div></figure>


<p>libjpeg.so.9在/usr/local/lib下面，首先尝试使用LDFALGS指定其路径，发现无效。</p>

<p>google到的解决办法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/lib$ sudo ranlib /usr/local/lib/libjpeg.a
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/lib$ sudo ldconfig /usr/local/lib</span></code></pre></td></tr></table></div></figure>


<p>之后再重新安装GraphicsMagick就正常了。</p>

<p>关于ranlib的作用见：<a href="http://blog.csdn.net/yuntongsf/article/details/6284517">http://blog.csdn.net/yuntongsf/article/details/6284517</a></p>

<p>关于ldconfig的作用见：<a href="http://blog.csdn.net/wooin/article/details/580679">http://blog.csdn.net/wooin/article/details/580679</a></p>

<h3>2.5 常用命令</h3>

<p>gm常用的命令如下，详细使用（包括例子）见<a href="http://www.graphicsmagick.org/utilities.html">官网手册</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:/usr/local/GraphicsMagick/GraphicsMagick-1.3.20$ gm
</span><span class='line'>GraphicsMagick 1.3.20 2014-08-16 Q8 http://www.GraphicsMagick.org/
</span><span class='line'>Copyright (C) 2002-2014 GraphicsMagick Group.
</span><span class='line'>Additional copyrights and licenses apply to this software.
</span><span class='line'>See http://www.GraphicsMagick.org/www/Copyright.html for details.
</span><span class='line'>Usage: gm command [options ...]
</span><span class='line'>
</span><span class='line'>Where commands include: 
</span><span class='line'>    animate - animate a sequence of images
</span><span class='line'>      batch - issue multiple commands in interactive or batch mode
</span><span class='line'>  benchmark - benchmark one of the other commands
</span><span class='line'>    compare - compare two images
</span><span class='line'>  composite - composite images together
</span><span class='line'>    conjure - execute a Magick Scripting Language (MSL) XML script
</span><span class='line'>    convert - convert an image or sequence of images
</span><span class='line'>    display - display an image on a workstation running X
</span><span class='line'>       help - obtain usage message for named command
</span><span class='line'>   identify - describe an image or image sequence
</span><span class='line'>     import - capture an application or X server screen
</span><span class='line'>    mogrify - transform an image or sequence of images
</span><span class='line'>    montage - create a composite image (in a grid) from separate images
</span><span class='line'>       time - time one of the other commands
</span><span class='line'>    version - obtain release version</span></code></pre></td></tr></table></div></figure>


<p>几个常用的命令如下：</p>

<h4>2.5.1 显示图片</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm display house.jpg</span></code></pre></td></tr></table></div></figure>


<p>原图如下：
<img src="/images/house.jpg"></p>

<h4>2.5.2 原图信息</h4>

<p>获取详细图片信息</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm identify -verbose house.jpg 
</span><span class='line'>Image: house.jpg
</span><span class='line'>  Format: JPEG (Joint Photographic Experts Group JFIF format)
</span><span class='line'>  Geometry: 480x300
</span><span class='line'>  Class: DirectClass
</span><span class='line'>  Type: true color
</span><span class='line'>  Depth: 8 bits-per-pixel component
</span><span class='line'>  Channel Depths:
</span><span class='line'>    Red:      8 bits
</span><span class='line'>    Green:    8 bits
</span><span class='line'>    Blue:     8 bits
</span><span class='line'>  Channel Statistics:
</span><span class='line'>    Red:
</span><span class='line'>      Minimum:                     0.00 (0.0000)
</span><span class='line'>      Maximum:                   255.00 (1.0000)
</span><span class='line'>      Mean:                      148.47 (0.5822)
</span><span class='line'>      Standard Deviation:         70.25 (0.2755)
</span><span class='line'>    Green:
</span><span class='line'>      Minimum:                     0.00 (0.0000)
</span><span class='line'>      Maximum:                   250.00 (0.9804)
</span><span class='line'>      Mean:                      128.17 (0.5026)
</span><span class='line'>      Standard Deviation:         58.91 (0.2310)
</span><span class='line'>    Blue:
</span><span class='line'>      Minimum:                     0.00 (0.0000)
</span><span class='line'>      Maximum:                   235.00 (0.9216)
</span><span class='line'>      Mean:                      100.93 (0.3958)
</span><span class='line'>      Standard Deviation:         56.00 (0.2196)
</span><span class='line'>  Filesize: 18.1K
</span><span class='line'>  Interlace: No
</span><span class='line'>  Orientation: Unknown
</span><span class='line'>  Background Color: white
</span><span class='line'>  Border Color: #DFDFDF
</span><span class='line'>  Matte Color: #BDBDBD
</span><span class='line'>  Page geometry: 480x300+0+0
</span><span class='line'>  Compose: Over
</span><span class='line'>  Dispose: Undefined
</span><span class='line'>  Iterations: 0
</span><span class='line'>  Compression: JPEG
</span><span class='line'>  JPEG-Quality: 75
</span><span class='line'>  JPEG-Colorspace: 2
</span><span class='line'>  JPEG-Colorspace-Name: RGB
</span><span class='line'>  JPEG-Sampling-factors: 2x2,1x1,1x1
</span><span class='line'>  Signature: 2bbf2e59864556b88e49e6fcaa7c2a7373fc0b7b28cb7b07dd16904c13ccf328
</span><span class='line'>  Tainted: False
</span><span class='line'>  Elapsed Time: 0:01
</span><span class='line'>  Pixels Per Second: 13.7M</span></code></pre></td></tr></table></div></figure>


<h4>2.5.3 格式转换</h4>

<p>需要当前的GraphicsMagick支持的格式，另外支持转换成pdf格式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert house.jpg house.png
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert house.jpg house.pdf</span></code></pre></td></tr></table></div></figure>


<p>png图片如下：
<img src="/images/house.png"></p>

<h4>2.5.4 图片缩放</h4>

<p>参数包含新的宽高</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert -resize 160x100 house.jpg -quality 90 house_160_100.jpg</span></code></pre></td></tr></table></div></figure>


<p>缩放效果如下：
<img src="/images/house_160_100.jpg"></p>

<h4>2.5.5 图片裁剪</h4>

<p>参数格式 ： 宽x高+左上角x+左上角y</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert -crop 200x200+50+50 house.jpg house_cut_200_200.jpg</span></code></pre></td></tr></table></div></figure>


<p>裁剪效果如下：
<img src="/images/house_cut_200_200.jpg"></p>

<h4>2.5.6 图片旋转</h4>

<p>参数为旋转角度，正数为顺时针旋转，负数为逆时针旋转</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert -rotate 90 house.jpg house_rotate_90.jpg
</span><span class='line'>
</span><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert -rotate -90 house.jpg house_rotate_-90.jpg</span></code></pre></td></tr></table></div></figure>


<p>旋转效果如下：
<img src="/images/house_rotate_90.jpg">
<img src="/images/house_rotate_-90.jpg"></p>

<h4>2.5.7 添加文字</h4>

<p>参数包括字体的样式，大小，添加的位置等</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xiaobaoqiu@xiaobaoqiu:~/Picture/testGraphicsMagick$ gm convert -font Arial -fill red -pointsize 18 -draw "text 50,50 'baoqiu.xiao'" house.jpg house_sign.jpg</span></code></pre></td></tr></table></div></figure>


<p>效果如下：
<img src="/images/house_sign.jpg"></p>

<h4>2.5.8 添加水印</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gm composite -geometry +50+50 -gravity southeast watermark.jpg house.jpg house_watermark.jpg</span></code></pre></td></tr></table></div></figure>


<p>效果如下：
<img src="/images/house_watermark.jpg"></p>

<h1>3. IM4JAVA</h1>

<p>GraphicsMagicK提供了常见的几种编程API接口，见<a href="http://www.graphicsmagick.org/programming.html">这里</a>,但是没有java的接口。常见的两个java支持库是JMagick和IM4JAVA。</p>

<h3>3.1 JMagick</h3>

<p>JMagick下载地址：<a href="http://www.jmagick.org/">http://www.jmagick.org/</a></p>

<p>JMagick存在的问题是有crash的风险，不稳定（见<a href="http://javantsky.iteye.com/blog/747807">这里</a>），并且存在图片生成错误的问题（见<a href="http://my.oschina.net/roaminlove/blog/96279">这里</a>）.</p>

<h3>3.2 IM4JAVA</h3>

<p>官方网站 ： <a href="http://im4java.sourceforge.net/index.html">http://im4java.sourceforge.net/index.html</a></p>

<p>下载地址 ： <a href="http://sourceforge.net/projects/im4java/files/">http://sourceforge.net/projects/im4java/files/</a></p>

<p>Maven支持：<a href="http://mvnrepository.com/artifact/org.im4java/im4java">http://mvnrepository.com/artifact/org.im4java/im4java</a>
示例如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;dependency&gt;
</span><span class='line'>    &lt;groupId&gt;org.im4java&lt;/groupId&gt;
</span><span class='line'>    &lt;artifactId&gt;im4java&lt;/artifactId&gt;
</span><span class='line'>    &lt;version&gt;1.4.0&lt;/version&gt;
</span><span class='line'>&lt;/dependency&gt;</span></code></pre></td></tr></table></div></figure>


<p>简单java示例代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * 按照规定的尺寸对图片进行缩放
</span><span class='line'> *
</span><span class='line'> * @param srcPath         需要缩放的源文件路径
</span><span class='line'> * @param destinationPath 生成图片的目标路径
</span><span class='line'> * @param needWidth       需要缩放的宽度
</span><span class='line'> * @param needHeight      需要缩放的高度
</span><span class='line'> * @param quality         图片的质量，0~25：差，50~75：中等，75~100高
</span><span class='line'> * @return
</span><span class='line'> */
</span><span class='line'>public static void zoom(String srcPath, String destinationPath, int needWidth, int needHeight, int quality) throws FsCommonException {
</span><span class='line'>    // 创建图片转换命令
</span><span class='line'>    ConvertCmd cmd = new ConvertCmd(true);
</span><span class='line'>    IMOperation op = new IMOperation();
</span><span class='line'>    op.addImage(srcPath);
</span><span class='line'>    op.resize(needWidth, needHeight);
</span><span class='line'>    //设置图片质量参数
</span><span class='line'>    if (quality &gt; 0) {
</span><span class='line'>        op.addRawArgs("-quality", String.valueOf(quality));
</span><span class='line'>    }
</span><span class='line'>    op.addImage(destinationPath);
</span><span class='line'>    try {
</span><span class='line'>        cmd.run(op);
</span><span class='line'>    } catch (Exception e) {
</span><span class='line'>        LOGGER.error("缩放图片失败,输入文件:" + srcPath, e);
</span><span class='line'>        ErrorCodeConstants.throwException(ErrorCodeConstants.CUT_FILE_FAIL);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">xiaobaoqiu</span></span>

      




<time class='entry-date' datetime='2014-09-09T17:54:59+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:54 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/tools/'>tools</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://xiaobaoqiu.github.io/blog/2014/09/09/graphicsmagick/" data-via="" data-counturl="http://xiaobaoqiu.github.io/blog/2014/09/09/graphicsmagick/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/04/linux-memory-usage/" title="Previous Post: Linux Memory Usage">&laquo; Linux Memory Usage</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/09/11/internal-jvm/" title="Next Post: JVM internals">JVM internals &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <div class="panel-heading">
    <h1 class="panel-title">最新文章</h3>
  </div>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/03/luceneru-men/">Lucene入门</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/03/mysql-join/">Mysql Join</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/27/zai-xian-zhen-duan-gong-ju/">在线诊断工具</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/22/chu-li-sqlchao-shi/">处理sql超时</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/22/mybatiskong-wherelan-jie-qi/">MyBatis空where拦截器</a>
      </li>
    
  </ul>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">文章分类</h1>
  </div>
  <div id="categories_list_div" class="list-group">
    <li><a class='list-group-item' href='/blog/categories/algorithm/'>algorithm (4)</a></li>
<li><a class='list-group-item' href='/blog/categories/druid/'>druid (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/dubbo/'>dubbo (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/guava/'>guava (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/java/'>java (23)</a></li>
<li><a class='list-group-item' href='/blog/categories/linux/'>linux (12)</a></li>
<li><a class='list-group-item' href='/blog/categories/maven/'>maven (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/memcached/'>memcached (4)</a></li>
<li><a class='list-group-item' href='/blog/categories/mybatis/'>mybatis (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/mysql/'>mysql (11)</a></li>
<li><a class='list-group-item' href='/blog/categories/octopress/'>octopress (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/postgresql/'>postgresql (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/qa/'>qa (2)</a></li>
<li><a class='list-group-item' href='/blog/categories/reading/'>reading (7)</a></li>
<li><a class='list-group-item' href='/blog/categories/search/'>search (7)</a></li>
<li><a class='list-group-item' href='/blog/categories/spring/'>spring (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/squid/'>squid (1)</a></li>
<li><a class='list-group-item' href='/blog/categories/structure/'>structure (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tomcat/'>tomcat (3)</a></li>
<li><a class='list-group-item' href='/blog/categories/tools/'>tools (8)</a></li>
<li><a class='list-group-item' href='/blog/categories/web/'>web (1)</a></li>
 
  </div>
</section>
<section class="panel panel-default">
  <div  class="panel-heading">
    <h1 class="panel-title">其他博客</h3>
  </div>
  <div id="categories_list_div" class="list-group">
    <a class='list-group-item' href='http://www.baidu.com/p/Nicker_2010'>百度空间</a>
  </div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - xiaobaoqiu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
